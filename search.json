[{"path":"https://2degreesinvesting.github.io/tiltWorkflows/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2023 tiltWorkflows authors Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/articles/profile_emissions.html","id":"setup","dir":"Articles","previous_headings":"","what":"Setup","title":"Run profile_emissions()","text":"","code":"library(dplyr, warn.conflicts = FALSE) library(readr, warn.conflicts = FALSE) library(rappdirs) library(future) library(fs) # Masking `tiltIndicatorAfter::profile*()` to handle larger datasets by chunks library(tiltWorkflows) #> Loading required package: tiltIndicatorAfter #> Loading required package: tiltToyData #>  #> Attaching package: 'tiltWorkflows' #> The following objects are masked from 'package:tiltIndicatorAfter': #>  #>     profile_emissions, profile_emissions_upstream, profile_sector, #>     profile_sector_upstream  options(   # Split data in chunks to save memory.   # TODO: Modify the parameter to try different numbers, e.g. 3, 30, 300 ...   tiltWorkflows.chunks = params$chunks,   # Read data quietly   readr.show_col_types = FALSE,   # Make printed output wider   width = 500 )  # Enable computing over multiple workers in parallel plan(multisession) # Create a folder to save results dir_create(params$output)"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/articles/profile_emissions.html","id":"data","dir":"Articles","previous_headings":"","what":"Data","title":"Run profile_emissions()","text":"example defaults using toy datasets may use parameters file instead use data.","code":"europages_companies <- path(params$input, params$europages_companies) |>   read_csv_falling_back_to(tiltIndicatorAfter::ep_companies) |>   # FIXME: Move to `profile_*()`   select(     \"company_name\",     \"country\",     \"company_city\",     \"postcode\",     \"address\",     \"main_activity\",     \"companies_id\"   ) #> Warning: Using tiltIndicatorAfter::ep_companies  ecoinvent_activities <- path(params$input, params$ecoinvent_activities) |>   read_csv_falling_back_to(tiltIndicatorAfter::ecoinvent_activities) #> Warning: Using tiltIndicatorAfter::ecoinvent_activities  ecoinvent_europages <- path(params$input, params$ecoinvent_europages) |>   read_csv_falling_back_to(tiltIndicatorAfter::matches_mapper) #> Warning: Using tiltIndicatorAfter::matches_mapper  isic <- path(params$input, params$isic) |>   read_csv_falling_back_to(tiltIndicatorAfter::isic_tilt_mapper) #> Warning: Using tiltIndicatorAfter::isic_tilt_mapper"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/articles/profile_emissions.html","id":"emissions-profile","dir":"Articles","previous_headings":"","what":"Emissions profile","title":"Run profile_emissions()","text":"","code":"# Load data specific to this indicator emissions_profile_any_companies <- path(params$input, params$emissions_profile_any_companies) |>   read_csv_falling_back_to(read_csv(toy_emissions_profile_any_companies())) #> Warning: Using read_csv(toy_emissions_profile_any_companies())  # FIXME User toy_emissions_profile_products_ecoinvent() # See https://github.com/2DegreesInvesting/tiltToyData/pull/12 # https://github.com/2DegreesInvesting/tiltWorkflows/issues/9 emissions_profile_products <- path(params$input, params$emissions_profile_products) |>   read_csv_falling_back_to(read_csv(toy_emissions_profile_products())) #> Warning: Using read_csv(toy_emissions_profile_products())  emissions_profile <- profile_emissions(   companies = emissions_profile_any_companies,   co2 = emissions_profile_products,   europages_companies = europages_companies,   ecoinvent_activities = ecoinvent_activities,   ecoinvent_europages = ecoinvent_europages,   isic = isic,   low_threshold = 1 / 3,   high_threshold = 2 / 3 )  emissions_profile |>   unnest_product() |>   write_csv(path(params$output, \"emissions_profile_at_product_level.csv\")) |>   print() #> # A tibble: 49 × 26 #>    companies_id                             company_name country PCTR_risk_category benchmark        ep_product matched_activity_name matched_reference_product unit  multi_match matching_certainty matching_certainty_company_average tilt_sector tilt_subsector isic_4digit isic_4digit_name company_city postcode address main_activity activity_uuid_product_uuid                                                profile_ranking extra_rowid ep_id category geography #>    <chr>                                    <chr>        <chr>   <chr>              <chr>            <chr>      <chr>                 <chr>                     <chr> <lgl>       <chr>              <chr>                              <chr>       <chr>          <chr>       <chr>            <chr>           <dbl> <chr>   <chr>         <chr>                                                                               <dbl>       <int> <chr> <chr>    <chr>     #>  1 fleischerei-stiefsohn_00000005219477-001 NA           NA      high               all              stove      NA                    NA                        NA    NA          NA                 NA                                 Industry    Other          '2560'      NA               NA                 NA NA      NA            0a242b09-772a-5edf-8e82-9cb4ba52a258_ae39ee61-d4d0-4cce-93b4-0745344da5fa           1               1 NA    NA       NA        #>  2 fleischerei-stiefsohn_00000005219477-001 NA           NA      high               isic_4digit      stove      NA                    NA                        NA    NA          NA                 NA                                 Industry    Other          '2560'      NA               NA                 NA NA      NA            0a242b09-772a-5edf-8e82-9cb4ba52a258_ae39ee61-d4d0-4cce-93b4-0745344da5fa           1               1 NA    NA       NA        #>  3 fleischerei-stiefsohn_00000005219477-001 NA           NA      high               tilt_sector      stove      NA                    NA                        NA    NA          NA                 NA                                 Industry    Other          '2560'      NA               NA                 NA NA      NA            0a242b09-772a-5edf-8e82-9cb4ba52a258_ae39ee61-d4d0-4cce-93b4-0745344da5fa           1               1 NA    NA       NA        #>  4 fleischerei-stiefsohn_00000005219477-001 NA           NA      high               unit             stove      NA                    NA                        NA    NA          NA                 NA                                 Industry    Other          '2560'      NA               NA                 NA NA      NA            0a242b09-772a-5edf-8e82-9cb4ba52a258_ae39ee61-d4d0-4cce-93b4-0745344da5fa           1               1 NA    NA       NA        #>  5 fleischerei-stiefsohn_00000005219477-001 NA           NA      high               unit_isic_4digit stove      NA                    NA                        NA    NA          NA                 NA                                 Industry    Other          '2560'      NA               NA                 NA NA      NA            0a242b09-772a-5edf-8e82-9cb4ba52a258_ae39ee61-d4d0-4cce-93b4-0745344da5fa           1               1 NA    NA       NA        #>  6 fleischerei-stiefsohn_00000005219477-001 NA           NA      high               unit_tilt_sector stove      NA                    NA                        NA    NA          NA                 NA                                 Industry    Other          '2560'      NA               NA                 NA NA      NA            0a242b09-772a-5edf-8e82-9cb4ba52a258_ae39ee61-d4d0-4cce-93b4-0745344da5fa           1               1 NA    NA       NA        #>  7 fleischerei-stiefsohn_00000005219477-001 NA           NA      high               all              oven       NA                    NA                        NA    NA          NA                 NA                                 Industry    Other          '2560'      NA               NA                 NA NA      NA            be06d25c-73dc-55fb-965b-0f300453e380_98b48ff2-2200-4b08-9dec-9c7c0e3585bc           0.8             2 NA    NA       NA        #>  8 fleischerei-stiefsohn_00000005219477-001 NA           NA      medium             isic_4digit      oven       NA                    NA                        NA    NA          NA                 NA                                 Industry    Other          '2560'      NA               NA                 NA NA      NA            be06d25c-73dc-55fb-965b-0f300453e380_98b48ff2-2200-4b08-9dec-9c7c0e3585bc           0.5             2 NA    NA       NA        #>  9 fleischerei-stiefsohn_00000005219477-001 NA           NA      medium             tilt_sector      oven       NA                    NA                        NA    NA          NA                 NA                                 Industry    Other          '2560'      NA               NA                 NA NA      NA            be06d25c-73dc-55fb-965b-0f300453e380_98b48ff2-2200-4b08-9dec-9c7c0e3585bc           0.667           2 NA    NA       NA        #> 10 fleischerei-stiefsohn_00000005219477-001 NA           NA      medium             unit             oven       NA                    NA                        NA    NA          NA                 NA                                 Industry    Other          '2560'      NA               NA                 NA NA      NA            be06d25c-73dc-55fb-965b-0f300453e380_98b48ff2-2200-4b08-9dec-9c7c0e3585bc           0.5             2 NA    NA       NA        #> # ℹ 39 more rows  emissions_profile |>   unnest_company() |>   write_csv(path(params$output, \"emissions_profile_at_company_level.csv\")) |>   print() #> # A tibble: 129 × 11 #>    companies_id                             company_name country PCTR_share PCTR_risk_category benchmark matching_certainty_company_average company_city postcode address main_activity #>    <chr>                                    <chr>        <chr>        <dbl> <lgl>              <lgl>     <chr>                              <chr>           <dbl> <chr>   <chr>         #>  1 fleischerei-stiefsohn_00000005219477-001 NA           NA             1   NA                 NA        NA                                 NA                 NA NA      NA            #>  2 fleischerei-stiefsohn_00000005219477-001 NA           NA             0   NA                 NA        NA                                 NA                 NA NA      NA            #>  3 fleischerei-stiefsohn_00000005219477-001 NA           NA             0   NA                 NA        NA                                 NA                 NA NA      NA            #>  4 fleischerei-stiefsohn_00000005219477-001 NA           NA             0.5 NA                 NA        NA                                 NA                 NA NA      NA            #>  5 fleischerei-stiefsohn_00000005219477-001 NA           NA             0.5 NA                 NA        NA                                 NA                 NA NA      NA            #>  6 fleischerei-stiefsohn_00000005219477-001 NA           NA             0   NA                 NA        NA                                 NA                 NA NA      NA            #>  7 fleischerei-stiefsohn_00000005219477-001 NA           NA             0.5 NA                 NA        NA                                 NA                 NA NA      NA            #>  8 fleischerei-stiefsohn_00000005219477-001 NA           NA             0.5 NA                 NA        NA                                 NA                 NA NA      NA            #>  9 fleischerei-stiefsohn_00000005219477-001 NA           NA             0   NA                 NA        NA                                 NA                 NA NA      NA            #> 10 fleischerei-stiefsohn_00000005219477-001 NA           NA             0.5 NA                 NA        NA                                 NA                 NA NA      NA            #> # ℹ 119 more rows"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/articles/profile_emissions.html","id":"results","dir":"Articles","previous_headings":"","what":"Results","title":"Run profile_emissions()","text":"","code":"# NOTE: If other workflows run before this one, this shows the results of all params$output |> dir_tree() #> ~/Downloads/tilt/output #> ├── emissions_profile_at_company_level.csv #> └── emissions_profile_at_product_level.csv"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/articles/profile_emissions.html","id":"cleanup","dir":"Articles","previous_headings":"","what":"Cleanup","title":"Run profile_emissions()","text":"cache allows resume interruptions. want recompute result, must first delete relevant cache:","code":"# NOTE: If other workflows run before this one, this shows the cache of all dir_tree(user_cache_dir(\"tiltWorkflows\")) #> ~/.cache/tiltWorkflows #> └── profile_emissions #>     ├── 1.rds #>     ├── 2.rds #>     └── 3.rds library(fs) library(rappdirs)  dir_delete(user_cache_dir(\"tiltWorkflows/PROFILE-DIRECTORY-YOU-WANT-TO-DELETE\"))"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/articles/profile_emissions_upstream.html","id":"setup","dir":"Articles","previous_headings":"","what":"Setup","title":"Run profile_emissions_upstream()","text":"","code":"library(dplyr, warn.conflicts = FALSE) library(readr, warn.conflicts = FALSE) library(rappdirs) library(future) library(fs) # Masking `tiltIndicatorAfter::profile*()` to handle larger datasets by chunks library(tiltWorkflows) #> Loading required package: tiltIndicatorAfter #> Loading required package: tiltToyData #>  #> Attaching package: 'tiltWorkflows' #> The following objects are masked from 'package:tiltIndicatorAfter': #>  #>     profile_emissions, profile_emissions_upstream, profile_sector, #>     profile_sector_upstream  options(   # Split data in chunks to save memory.   # TODO: Modify the parameter to try different numbers, e.g. 3, 30, 300 ...   tiltWorkflows.chunks = params$chunks,   # Read data quietly   readr.show_col_types = FALSE,   # Make printed output wider   width = 500 )  # Enable computing over multiple workers in parallel plan(multisession) # Create a folder to save results dir_create(params$output)"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/articles/profile_emissions_upstream.html","id":"data","dir":"Articles","previous_headings":"","what":"Data","title":"Run profile_emissions_upstream()","text":"example defaults using toy datasets may use parameters file instead use data.","code":"europages_companies <- path(params$input, params$europages_companies) |>   read_csv_falling_back_to(tiltIndicatorAfter::ep_companies) |>   # FIXME: Move to `profile_*()`   select(     \"company_name\",     \"country\",     \"company_city\",     \"postcode\",     \"address\",     \"main_activity\",     \"companies_id\"   ) #> Warning: Using tiltIndicatorAfter::ep_companies  ecoinvent_activities <- path(params$input, params$ecoinvent_activities) |>   read_csv_falling_back_to(tiltIndicatorAfter::ecoinvent_activities) #> Warning: Using tiltIndicatorAfter::ecoinvent_activities  ecoinvent_europages <- path(params$input, params$ecoinvent_europages) |>   read_csv_falling_back_to(tiltIndicatorAfter::matches_mapper) #> Warning: Using tiltIndicatorAfter::matches_mapper  isic <- path(params$input, params$isic) |>   read_csv_falling_back_to(tiltIndicatorAfter::isic_tilt_mapper) #> Warning: Using tiltIndicatorAfter::isic_tilt_mapper ecoinvent_inputs <- path(params$input, params$ecoinvent_inputs) |>   read_csv_falling_back_to(tiltIndicatorAfter::ecoinvent_inputs) |>   # FIXME: Move to `profile_*()`   select(     \"input_activity_uuid_product_uuid\",     \"exchange_name\",     \"exchange_unit_name\"   ) |>   distinct() #> Warning: Using tiltIndicatorAfter::ecoinvent_inputs"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/articles/profile_emissions_upstream.html","id":"emissions-profile-upstream","dir":"Articles","previous_headings":"","what":"Emissions profile upstream","title":"Run profile_emissions_upstream()","text":"","code":"# Load data specific to this indicator emissions_profile_any_companies <- path(params$input, params$emissions_profile_any_companies) |>   read_csv_falling_back_to(read_csv(toy_emissions_profile_any_companies())) #> Warning: Using read_csv(toy_emissions_profile_any_companies())  # Load data specific to this indicator # FIXME User toy_emissions_profile_upstream_products_ecoinvent() # See https://github.com/2DegreesInvesting/tiltToyData/pull/12 # https://github.com/2DegreesInvesting/tiltWorkflows/issues/9 emissions_profile_upstream_products <- path(params$input, params$emissions_profile_upstream_products) |>   read_csv_falling_back_to(read_csv(toy_emissions_profile_upstream_products())) #> Warning: Using read_csv(toy_emissions_profile_upstream_products())  # Create results at product and company level emissions_profile_upstream <- profile_emissions_upstream(   companies = emissions_profile_any_companies,   co2 = emissions_profile_upstream_products,   europages_companies = europages_companies,   ecoinvent_activities = ecoinvent_activities,   ecoinvent_inputs = ecoinvent_inputs,   ecoinvent_europages = ecoinvent_europages,   isic = isic,   low_threshold = 1 / 3,   high_threshold = 2 / 3 )  emissions_profile_upstream |>   unnest_product() |>   write_csv(path(params$output, \"emissions_profile_upstream_at_product_level.csv\")) |>   print() #> # A tibble: 319 × 27 #>    companies_id                             company_name country ICTR_risk_category benchmark         ep_product matched_activity_name matched_reference_product unit  multi_match matching_certainty matching_certainty_company_average input_name input_unit input_tilt_sector input_tilt_subsector input_isic_4digit input_isic_4digit_name company_city postcode address main_activity activity_uuid_product_uuid                                                profile_ranking extra_rowid ep_id category #>    <chr>                                    <chr>        <chr>   <chr>              <chr>             <chr>      <chr>                 <chr>                     <chr> <lgl>       <chr>              <chr>                              <chr>      <chr>      <chr>             <chr>                <chr>             <chr>                  <chr>           <dbl> <chr>   <chr>         <chr>                                                                               <dbl>       <int> <chr> <chr>    #>  1 fleischerei-stiefsohn_00000005219477-001 NA           NA      high               all               stove      NA                    NA                        NA    NA          NA                 NA                                 NA         NA         Inudstry          Other                '2560'            NA                     NA                 NA NA      NA            0a242b09-772a-5edf-8e82-9cb4ba52a258_ae39ee61-d4d0-4cce-93b4-0745344da5fa          0.909            1 NA    NA       #>  2 fleischerei-stiefsohn_00000005219477-001 NA           NA      high               all               stove      NA                    NA                        NA    NA          NA                 NA                                 NA         NA         Inudstry          Other                '2560'            NA                     NA                 NA NA      NA            0a242b09-772a-5edf-8e82-9cb4ba52a258_ae39ee61-d4d0-4cce-93b4-0745344da5fa          1                2 NA    NA       #>  3 fleischerei-stiefsohn_00000005219477-001 NA           NA      medium             all               stove      NA                    NA                        NA    NA          NA                 NA                                 NA         NA         Inudstry          Other                '2560'            NA                     NA                 NA NA      NA            0a242b09-772a-5edf-8e82-9cb4ba52a258_ae39ee61-d4d0-4cce-93b4-0745344da5fa          0.636            3 NA    NA       #>  4 fleischerei-stiefsohn_00000005219477-001 NA           NA      high               all               stove      NA                    NA                        NA    NA          NA                 NA                                 NA         NA         Inudstry          Other                '2560'            NA                     NA                 NA NA      NA            0a242b09-772a-5edf-8e82-9cb4ba52a258_ae39ee61-d4d0-4cce-93b4-0745344da5fa          0.758            4 NA    NA       #>  5 fleischerei-stiefsohn_00000005219477-001 NA           NA      high               all               stove      NA                    NA                        NA    NA          NA                 NA                                 NA         NA         Inudstry          Other                '2560'            NA                     NA                 NA NA      NA            0a242b09-772a-5edf-8e82-9cb4ba52a258_ae39ee61-d4d0-4cce-93b4-0745344da5fa          0.970            5 NA    NA       #>  6 fleischerei-stiefsohn_00000005219477-001 NA           NA      low                all               stove      NA                    NA                        NA    NA          NA                 NA                                 NA         NA         Inudstry          Other                '2560'            NA                     NA                 NA NA      NA            0a242b09-772a-5edf-8e82-9cb4ba52a258_ae39ee61-d4d0-4cce-93b4-0745344da5fa          0.0909           6 NA    NA       #>  7 fleischerei-stiefsohn_00000005219477-001 NA           NA      low                all               stove      NA                    NA                        NA    NA          NA                 NA                                 NA         NA         Inudstry          Other                '2560'            NA                     NA                 NA NA      NA            0a242b09-772a-5edf-8e82-9cb4ba52a258_ae39ee61-d4d0-4cce-93b4-0745344da5fa          0.121            7 NA    NA       #>  8 fleischerei-stiefsohn_00000005219477-001 NA           NA      high               all               stove      NA                    NA                        NA    NA          NA                 NA                                 NA         NA         Inudstry          Other                '2560'            NA                     NA                 NA NA      NA            0a242b09-772a-5edf-8e82-9cb4ba52a258_ae39ee61-d4d0-4cce-93b4-0745344da5fa          0.697            8 NA    NA       #>  9 fleischerei-stiefsohn_00000005219477-001 NA           NA      high               input_isic_4digit stove      NA                    NA                        NA    NA          NA                 NA                                 NA         NA         Inudstry          Other                '2560'            NA                     NA                 NA NA      NA            0a242b09-772a-5edf-8e82-9cb4ba52a258_ae39ee61-d4d0-4cce-93b4-0745344da5fa          0.857            1 NA    NA       #> 10 fleischerei-stiefsohn_00000005219477-001 NA           NA      high               input_isic_4digit stove      NA                    NA                        NA    NA          NA                 NA                                 NA         NA         Inudstry          Other                '2560'            NA                     NA                 NA NA      NA            0a242b09-772a-5edf-8e82-9cb4ba52a258_ae39ee61-d4d0-4cce-93b4-0745344da5fa          1                2 NA    NA       #> # ℹ 309 more rows  emissions_profile_upstream |>   unnest_company() |>   write_csv(path(params$output, \"emissions_profile_upstream_at_company_level.csv\")) |>   print() #> # A tibble: 127 × 11 #>    companies_id                             company_name company_city country ICTR_share ICTR_risk_category benchmark         matching_certainty_company_average postcode address main_activity #>    <chr>                                    <chr>        <chr>        <chr>        <dbl> <chr>              <chr>             <chr>                                 <dbl> <chr>   <chr>         #>  1 fleischerei-stiefsohn_00000005219477-001 NA           NA           NA           0.571 high               all               NA                                       NA NA      NA            #>  2 fleischerei-stiefsohn_00000005219477-001 NA           NA           NA           0.214 medium             all               NA                                       NA NA      NA            #>  3 fleischerei-stiefsohn_00000005219477-001 NA           NA           NA           0.214 low                all               NA                                       NA NA      NA            #>  4 fleischerei-stiefsohn_00000005219477-001 NA           NA           NA           0.357 high               input_isic_4digit NA                                       NA NA      NA            #>  5 fleischerei-stiefsohn_00000005219477-001 NA           NA           NA           0.357 medium             input_isic_4digit NA                                       NA NA      NA            #>  6 fleischerei-stiefsohn_00000005219477-001 NA           NA           NA           0.286 low                input_isic_4digit NA                                       NA NA      NA            #>  7 fleischerei-stiefsohn_00000005219477-001 NA           NA           NA           0.429 high               input_tilt_sector NA                                       NA NA      NA            #>  8 fleischerei-stiefsohn_00000005219477-001 NA           NA           NA           0.357 medium             input_tilt_sector NA                                       NA NA      NA            #>  9 fleischerei-stiefsohn_00000005219477-001 NA           NA           NA           0.214 low                input_tilt_sector NA                                       NA NA      NA            #> 10 fleischerei-stiefsohn_00000005219477-001 NA           NA           NA           0.429 high               input_unit        NA                                       NA NA      NA            #> # ℹ 117 more rows"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/articles/profile_emissions_upstream.html","id":"results","dir":"Articles","previous_headings":"","what":"Results","title":"Run profile_emissions_upstream()","text":"","code":"# NOTE: If other workflows run before this one, this shows the results of all params$output |> dir_tree() #> ~/Downloads/tilt/output #> ├── emissions_profile_at_company_level.csv #> ├── emissions_profile_at_product_level.csv #> ├── emissions_profile_upstream_at_company_level.csv #> └── emissions_profile_upstream_at_product_level.csv"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/articles/profile_emissions_upstream.html","id":"cleanup","dir":"Articles","previous_headings":"","what":"Cleanup","title":"Run profile_emissions_upstream()","text":"cache allows resume interruptions. want recompute result, must first delete relevant cache:","code":"# NOTE: If other workflows run before this one, this shows the cache of all dir_tree(user_cache_dir(\"tiltWorkflows\")) #> ~/.cache/tiltWorkflows #> ├── profile_emissions #> │   ├── 1.rds #> │   ├── 2.rds #> │   └── 3.rds #> └── profile_emissions_upstream #>     ├── 1.rds #>     ├── 2.rds #>     └── 3.rds library(fs) library(rappdirs)  dir_delete(user_cache_dir(\"tiltWorkflows/PROFILE-DIRECTORY-YOU-WANT-TO-DELETE\"))"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/articles/profile_sector.html","id":"setup","dir":"Articles","previous_headings":"","what":"Setup","title":"Run profile_sector()","text":"","code":"library(dplyr, warn.conflicts = FALSE) library(readr, warn.conflicts = FALSE) library(rappdirs) library(future) library(fs) # Masking `tiltIndicatorAfter::profile*()` to handle larger datasets by chunks library(tiltWorkflows) #> Loading required package: tiltIndicatorAfter #> Loading required package: tiltToyData #>  #> Attaching package: 'tiltWorkflows' #> The following objects are masked from 'package:tiltIndicatorAfter': #>  #>     profile_emissions, profile_emissions_upstream, profile_sector, #>     profile_sector_upstream  options(   # Split data in chunks to save memory.   # TODO: Modify the parameter to try different numbers, e.g. 3, 30, 300 ...   tiltWorkflows.chunks = params$chunks,   # Read data quietly   readr.show_col_types = FALSE,   # Make printed output wider   width = 500 )  # Enable computing over multiple workers in parallel plan(multisession) # Create a folder to save results dir_create(params$output)"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/articles/profile_sector.html","id":"data","dir":"Articles","previous_headings":"","what":"Data","title":"Run profile_sector()","text":"example defaults using toy datasets may use parameters file instead use data.","code":"europages_companies <- path(params$input, params$europages_companies) |>   read_csv_falling_back_to(tiltIndicatorAfter::ep_companies) |>   # FIXME: Move to `profile_*()`   select(     \"company_name\",     \"country\",     \"company_city\",     \"postcode\",     \"address\",     \"main_activity\",     \"companies_id\"   ) #> Warning: Using tiltIndicatorAfter::ep_companies  ecoinvent_activities <- path(params$input, params$ecoinvent_activities) |>   read_csv_falling_back_to(tiltIndicatorAfter::ecoinvent_activities) #> Warning: Using tiltIndicatorAfter::ecoinvent_activities  ecoinvent_europages <- path(params$input, params$ecoinvent_europages) |>   read_csv_falling_back_to(tiltIndicatorAfter::matches_mapper) #> Warning: Using tiltIndicatorAfter::matches_mapper  isic <- path(params$input, params$isic) |>   read_csv_falling_back_to(tiltIndicatorAfter::isic_tilt_mapper) #> Warning: Using tiltIndicatorAfter::isic_tilt_mapper"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/articles/profile_sector.html","id":"sector-profile","dir":"Articles","previous_headings":"","what":"Sector profile","title":"Run profile_sector()","text":"","code":"# Load data specific to this indicator sector_profile_companies <- path(params$input, params$sector_profile_companies) |>   read_csv_falling_back_to(read_csv(toy_sector_profile_companies())) #> Warning: Using read_csv(toy_sector_profile_companies())  sector_profile_any_scenarios <- path(params$input, params$sector_profile_any_scenarios) |>   read_csv_falling_back_to(read_csv(toy_sector_profile_any_scenarios())) #> Warning: Using read_csv(toy_sector_profile_any_scenarios())  # Create results at product and company level sector_profile <- profile_sector(   companies = sector_profile_companies,   scenarios = sector_profile_any_scenarios,   europages_companies = europages_companies,   ecoinvent_activities = ecoinvent_activities,   ecoinvent_europages = ecoinvent_europages,   isic = isic,   low_threshold = 1 / 3,   high_threshold = 2 / 3 )  sector_profile |>   unnest_product() |>   write_csv(path(params$output, \"sector_profile_at_product_level.csv\")) |>   print() #> # A tibble: 196 × 28 #>    companies_id                             company_name country PSTR_risk_category scenario                             year ep_product matched_activity_name matched_reference_product unit  tilt_sector tilt_subsector multi_match matching_certainty matching_certainty_company_average company_city postcode address main_activity activity_uuid_product_uuid                                   profile_ranking extra_rowid isic_4digit sector   subsector      ep_id category isic_4digit_name #>    <chr>                                    <chr>        <chr>   <chr>              <chr>                               <dbl> <chr>      <chr>                 <chr>                     <chr> <chr>       <chr>          <lgl>       <chr>              <chr>                              <chr>           <dbl> <chr>   <chr>         <chr>                                                                  <dbl>       <int> <chr>       <chr>    <chr>          <chr> <chr>    <chr>            #>  1 fleischerei-stiefsohn_00000005219477-001 NA           NA      low                IPR 1.5c RPS                         2030 steel      NA                    NA                        NA    NA          NA             NA          NA                 NA                                 NA                 NA NA      NA            0faa7ecb-fef2-5117-8993-387c1236-001e-49b5-aa3d-810c0214f9ce          0.23             1 '2410'      industry iron and steel NA    NA       NA               #>  2 fleischerei-stiefsohn_00000005219477-001 NA           NA      high               IPR 1.5c RPS                         2050 steel      NA                    NA                        NA    NA          NA             NA          NA                 NA                                 NA                 NA NA      NA            0faa7ecb-fef2-5117-8993-387c1236-001e-49b5-aa3d-810c0214f9ce          0.96             1 '2410'      industry iron and steel NA    NA       NA               #>  3 fleischerei-stiefsohn_00000005219477-001 NA           NA      low                stated policies scenario             2020 steel      NA                    NA                        NA    NA          NA             NA          NA                 NA                                 NA                 NA NA      NA            0faa7ecb-fef2-5117-8993-387c1236-001e-49b5-aa3d-810c0214f9ce          0                2 '2410'      total    iron and steel NA    NA       NA               #>  4 fleischerei-stiefsohn_00000005219477-001 NA           NA      low                announced pledges scenario           2020 steel      NA                    NA                        NA    NA          NA             NA          NA                 NA                                 NA                 NA NA      NA            0faa7ecb-fef2-5117-8993-387c1236-001e-49b5-aa3d-810c0214f9ce          0                2 '2410'      total    iron and steel NA    NA       NA               #>  5 fleischerei-stiefsohn_00000005219477-001 NA           NA      low                net zero emissions by 2050 scenario  2020 steel      NA                    NA                        NA    NA          NA             NA          NA                 NA                                 NA                 NA NA      NA            0faa7ecb-fef2-5117-8993-387c1236-001e-49b5-aa3d-810c0214f9ce          0                2 '2410'      total    iron and steel NA    NA       NA               #>  6 fleischerei-stiefsohn_00000005219477-001 NA           NA      low                stated policies scenario             2030 steel      NA                    NA                        NA    NA          NA             NA          NA                 NA                                 NA                 NA NA      NA            0faa7ecb-fef2-5117-8993-387c1236-001e-49b5-aa3d-810c0214f9ce         -0.0752           2 '2410'      total    iron and steel NA    NA       NA               #>  7 fleischerei-stiefsohn_00000005219477-001 NA           NA      low                announced pledges scenario           2030 steel      NA                    NA                        NA    NA          NA             NA          NA                 NA                                 NA                 NA NA      NA            0faa7ecb-fef2-5117-8993-387c1236-001e-49b5-aa3d-810c0214f9ce          0.0781           2 '2410'      total    iron and steel NA    NA       NA               #>  8 fleischerei-stiefsohn_00000005219477-001 NA           NA      low                net zero emissions by 2050 scenario  2030 steel      NA                    NA                        NA    NA          NA             NA          NA                 NA                                 NA                 NA NA      NA            0faa7ecb-fef2-5117-8993-387c1236-001e-49b5-aa3d-810c0214f9ce          0.233            2 '2410'      total    iron and steel NA    NA       NA               #>  9 fleischerei-stiefsohn_00000005219477-001 NA           NA      low                stated policies scenario             2040 steel      NA                    NA                        NA    NA          NA             NA          NA                 NA                                 NA                 NA NA      NA            0faa7ecb-fef2-5117-8993-387c1236-001e-49b5-aa3d-810c0214f9ce         -0.0270           2 '2410'      total    iron and steel NA    NA       NA               #> 10 fleischerei-stiefsohn_00000005219477-001 NA           NA      medium             announced pledges scenario           2040 steel      NA                    NA                        NA    NA          NA             NA          NA                 NA                                 NA                 NA NA      NA            0faa7ecb-fef2-5117-8993-387c1236-001e-49b5-aa3d-810c0214f9ce          0.336            2 '2410'      total    iron and steel NA    NA       NA               #> # ℹ 186 more rows  sector_profile |>   unnest_company() |>   write_csv(path(params$output, \"sector_profile_at_company_level.csv\")) |>   print() #> # A tibble: 588 × 12 #>    companies_id                             company_name country PSTR_share PSTR_risk_category scenario                   year  matching_certainty_company_average company_city postcode address main_activity #>    <chr>                                    <chr>        <chr>        <dbl> <chr>              <chr>                      <chr> <chr>                              <chr>           <dbl> <chr>   <chr>         #>  1 fleischerei-stiefsohn_00000005219477-001 NA           NA               0 high               IPR 1.5c RPS               2030  NA                                 NA                 NA NA      NA            #>  2 fleischerei-stiefsohn_00000005219477-001 NA           NA               0 medium             IPR 1.5c RPS               2030  NA                                 NA                 NA NA      NA            #>  3 fleischerei-stiefsohn_00000005219477-001 NA           NA               1 low                IPR 1.5c RPS               2030  NA                                 NA                 NA NA      NA            #>  4 fleischerei-stiefsohn_00000005219477-001 NA           NA               1 high               IPR 1.5c RPS               2050  NA                                 NA                 NA NA      NA            #>  5 fleischerei-stiefsohn_00000005219477-001 NA           NA               0 medium             IPR 1.5c RPS               2050  NA                                 NA                 NA NA      NA            #>  6 fleischerei-stiefsohn_00000005219477-001 NA           NA               0 low                IPR 1.5c RPS               2050  NA                                 NA                 NA NA      NA            #>  7 fleischerei-stiefsohn_00000005219477-001 NA           NA               0 high               announced pledges scenario 2020  NA                                 NA                 NA NA      NA            #>  8 fleischerei-stiefsohn_00000005219477-001 NA           NA               0 medium             announced pledges scenario 2020  NA                                 NA                 NA NA      NA            #>  9 fleischerei-stiefsohn_00000005219477-001 NA           NA               1 low                announced pledges scenario 2020  NA                                 NA                 NA NA      NA            #> 10 fleischerei-stiefsohn_00000005219477-001 NA           NA               0 high               announced pledges scenario 2030  NA                                 NA                 NA NA      NA            #> # ℹ 578 more rows"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/articles/profile_sector.html","id":"results","dir":"Articles","previous_headings":"","what":"Results","title":"Run profile_sector()","text":"","code":"# NOTE: If other workflows run before this one, this shows the results of all params$output |> dir_tree() #> ~/Downloads/tilt/output #> ├── emissions_profile_at_company_level.csv #> ├── emissions_profile_at_product_level.csv #> ├── emissions_profile_upstream_at_company_level.csv #> ├── emissions_profile_upstream_at_product_level.csv #> ├── sector_profile_at_company_level.csv #> └── sector_profile_at_product_level.csv"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/articles/profile_sector.html","id":"cleanup","dir":"Articles","previous_headings":"","what":"Cleanup","title":"Run profile_sector()","text":"cache allows resume interruptions. want recompute result, must first delete relevant cache:","code":"# NOTE: If other workflows run before this one, this shows the cache of all dir_tree(user_cache_dir(\"tiltWorkflows\")) #> ~/.cache/tiltWorkflows #> ├── profile_emissions #> │   ├── 1.rds #> │   ├── 2.rds #> │   └── 3.rds #> ├── profile_emissions_upstream #> │   ├── 1.rds #> │   ├── 2.rds #> │   └── 3.rds #> └── profile_sector #>     ├── 1.rds #>     ├── 2.rds #>     └── 3.rds library(fs) library(rappdirs)  dir_delete(user_cache_dir(\"tiltWorkflows/PROFILE-DIRECTORY-YOU-WANT-TO-DELETE\"))"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/articles/profile_sector_upstream.html","id":"setup","dir":"Articles","previous_headings":"","what":"Setup","title":"Run profile_sector_upstream()","text":"","code":"library(dplyr, warn.conflicts = FALSE) library(readr, warn.conflicts = FALSE) library(rappdirs) library(future) library(fs) # Masking `tiltIndicatorAfter::profile*()` to handle larger datasets by chunks library(tiltWorkflows) #> Loading required package: tiltIndicatorAfter #> Loading required package: tiltToyData #>  #> Attaching package: 'tiltWorkflows' #> The following objects are masked from 'package:tiltIndicatorAfter': #>  #>     profile_emissions, profile_emissions_upstream, profile_sector, #>     profile_sector_upstream  options(   # Split data in chunks to save memory.   # TODO: Modify the parameter to try different numbers, e.g. 3, 30, 300 ...   tiltWorkflows.chunks = params$chunks,   # Read data quietly   readr.show_col_types = FALSE,   # Make printed output wider   width = 500 )  # Enable computing over multiple workers in parallel plan(multisession) # Create a folder to save results dir_create(params$output)"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/articles/profile_sector_upstream.html","id":"data","dir":"Articles","previous_headings":"","what":"Data","title":"Run profile_sector_upstream()","text":"example defaults using toy datasets may use parameters file instead use data.","code":"europages_companies <- path(params$input, params$europages_companies) |>   read_csv_falling_back_to(tiltIndicatorAfter::ep_companies) |>   # FIXME: Move to `profile_*()`   select(     \"company_name\",     \"country\",     \"company_city\",     \"postcode\",     \"address\",     \"main_activity\",     \"companies_id\"   ) #> Warning: Using tiltIndicatorAfter::ep_companies  ecoinvent_activities <- path(params$input, params$ecoinvent_activities) |>   read_csv_falling_back_to(tiltIndicatorAfter::ecoinvent_activities) #> Warning: Using tiltIndicatorAfter::ecoinvent_activities  ecoinvent_europages <- path(params$input, params$ecoinvent_europages) |>   read_csv_falling_back_to(tiltIndicatorAfter::matches_mapper) #> Warning: Using tiltIndicatorAfter::matches_mapper  isic <- path(params$input, params$isic) |>   read_csv_falling_back_to(tiltIndicatorAfter::isic_tilt_mapper) #> Warning: Using tiltIndicatorAfter::isic_tilt_mapper ecoinvent_inputs <- path(params$input, params$ecoinvent_inputs) |>   read_csv_falling_back_to(tiltIndicatorAfter::ecoinvent_inputs) |>   # FIXME: Move to `profile_*()`   select(     \"input_activity_uuid_product_uuid\",     \"exchange_name\",     \"exchange_unit_name\"   ) |>   distinct() #> Warning: Using tiltIndicatorAfter::ecoinvent_inputs"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/articles/profile_sector_upstream.html","id":"sector-profile-upstream","dir":"Articles","previous_headings":"","what":"Sector profile upstream","title":"Run profile_sector_upstream()","text":"","code":"# Load data specific to this indicator sector_profile_upstream_companies <- path(params$input, params$sector_profile_upstream_companies) |>   read_csv_falling_back_to(read_csv(toy_sector_profile_upstream_companies())) #> Warning: Using read_csv(toy_sector_profile_upstream_companies())  sector_profile_any_scenarios <- path(params$input, params$sector_profile_any_scenarios) |>   read_csv_falling_back_to(read_csv(toy_sector_profile_any_scenarios())) #> Warning: Using read_csv(toy_sector_profile_any_scenarios())  sector_profile_upstream_products <- path(params$input, params$sector_profile_upstream_products) |>   read_csv_falling_back_to(read_csv(toy_sector_profile_upstream_products())) #> Warning: Using read_csv(toy_sector_profile_upstream_products())  # Create results at product and company level sector_profile_upstream <- profile_sector_upstream(   companies = sector_profile_upstream_companies,   scenarios = sector_profile_any_scenarios,   inputs = sector_profile_upstream_products,   europages_companies = europages_companies,   ecoinvent_activities = ecoinvent_activities,   ecoinvent_inputs = ecoinvent_inputs,   ecoinvent_europages = ecoinvent_europages,   isic = isic,   low_threshold = 1 / 3,   high_threshold = 2 / 3 )  sector_profile_upstream |>   unnest_product() |>   write_csv(path(params$output, \"sector_profile_upstream_at_product_level.csv\")) |>   print() #> # A tibble: 704 × 31 #>    companies_id                             company_name country ISTR_risk_category scenario                             year ep_product matched_activity_name matched_reference_product unit  tilt_sector multi_match matching_certainty matching_certainty_company_average input_name input_unit input_tilt_sector    input_tilt_subsector company_city postcode address main_activity activity_uuid_produc…¹ profile_ranking extra_rowid input_isic_4digit sector subsector input_isic_4digit_name ep_id category #>    <chr>                                    <chr>        <chr>   <chr>              <chr>                               <dbl> <chr>      <chr>                 <chr>                     <chr> <chr>       <lgl>       <chr>              <chr>                              <chr>      <chr>      <chr>                <chr>                <chr>           <dbl> <chr>   <chr>         <chr>                            <dbl>       <int> <chr>             <chr>  <chr>     <chr>                  <chr> <chr>    #>  1 fleischerei-stiefsohn_00000005219477-001 NA           NA      low                stated policies scenario             2020 stove      NA                    NA                        NA    energy      NA          NA                 NA                                 NA         NA         non-metallic minera… raw minerals         NA                 NA NA      NA            0a242b09-772a-5edf-8e…           0               2 '3821'            bioen… total en… NA                     NA    NA       #>  2 fleischerei-stiefsohn_00000005219477-001 NA           NA      low                stated policies scenario             2030 stove      NA                    NA                        NA    energy      NA          NA                 NA                                 NA         NA         non-metallic minera… raw minerals         NA                 NA NA      NA            0a242b09-772a-5edf-8e…          -0.192           2 '3821'            bioen… total en… NA                     NA    NA       #>  3 fleischerei-stiefsohn_00000005219477-001 NA           NA      low                stated policies scenario             2040 stove      NA                    NA                        NA    energy      NA          NA                 NA                                 NA         NA         non-metallic minera… raw minerals         NA                 NA NA      NA            0a242b09-772a-5edf-8e…          -0.517           2 '3821'            bioen… total en… NA                     NA    NA       #>  4 fleischerei-stiefsohn_00000005219477-001 NA           NA      low                stated policies scenario             2050 stove      NA                    NA                        NA    energy      NA          NA                 NA                                 NA         NA         non-metallic minera… raw minerals         NA                 NA NA      NA            0a242b09-772a-5edf-8e…          -0.689           2 '3821'            bioen… total en… NA                     NA    NA       #>  5 fleischerei-stiefsohn_00000005219477-001 NA           NA      low                announced pledges scenario           2020 stove      NA                    NA                        NA    energy      NA          NA                 NA                                 NA         NA         non-metallic minera… raw minerals         NA                 NA NA      NA            0a242b09-772a-5edf-8e…           0               2 '3821'            bioen… total en… NA                     NA    NA       #>  6 fleischerei-stiefsohn_00000005219477-001 NA           NA      low                announced pledges scenario           2030 stove      NA                    NA                        NA    energy      NA          NA                 NA                                 NA         NA         non-metallic minera… raw minerals         NA                 NA NA      NA            0a242b09-772a-5edf-8e…           0.301           2 '3821'            bioen… total en… NA                     NA    NA       #>  7 fleischerei-stiefsohn_00000005219477-001 NA           NA      high               announced pledges scenario           2040 stove      NA                    NA                        NA    energy      NA          NA                 NA                                 NA         NA         non-metallic minera… raw minerals         NA                 NA NA      NA            0a242b09-772a-5edf-8e…           1.83            2 '3821'            bioen… total en… NA                     NA    NA       #>  8 fleischerei-stiefsohn_00000005219477-001 NA           NA      high               announced pledges scenario           2050 stove      NA                    NA                        NA    energy      NA          NA                 NA                                 NA         NA         non-metallic minera… raw minerals         NA                 NA NA      NA            0a242b09-772a-5edf-8e…           3.17            2 '3821'            bioen… total en… NA                     NA    NA       #>  9 fleischerei-stiefsohn_00000005219477-001 NA           NA      low                net zero emissions by 2050 scenario  2020 stove      NA                    NA                        NA    energy      NA          NA                 NA                                 NA         NA         non-metallic minera… raw minerals         NA                 NA NA      NA            0a242b09-772a-5edf-8e…           0               2 '3821'            bioen… total en… NA                     NA    NA       #> 10 fleischerei-stiefsohn_00000005219477-001 NA           NA      high               net zero emissions by 2050 scenario  2030 stove      NA                    NA                        NA    energy      NA          NA                 NA                                 NA         NA         non-metallic minera… raw minerals         NA                 NA NA      NA            0a242b09-772a-5edf-8e…           0.909           2 '3821'            bioen… total en… NA                     NA    NA       #> # ℹ 694 more rows #> # ℹ abbreviated name: ¹​activity_uuid_product_uuid  sector_profile_upstream |>   unnest_company() |>   write_csv(path(params$output, \"sector_profile_upstream_at_company_level.csv\")) |>   print() #> # A tibble: 294 × 12 #>    companies_id                             company_name country ISTR_share ISTR_risk_category scenario                   year  matching_certainty_company_average company_city postcode address main_activity #>    <chr>                                    <chr>        <chr>        <dbl> <chr>              <chr>                      <chr> <chr>                              <chr>           <dbl> <chr>   <chr>         #>  1 fleischerei-stiefsohn_00000005219477-001 NA           NA           0     high               IPR 1.5c RPS               2030  NA                                 NA                 NA NA      NA            #>  2 fleischerei-stiefsohn_00000005219477-001 NA           NA           0.167 medium             IPR 1.5c RPS               2030  NA                                 NA                 NA NA      NA            #>  3 fleischerei-stiefsohn_00000005219477-001 NA           NA           0.833 low                IPR 1.5c RPS               2030  NA                                 NA                 NA NA      NA            #>  4 fleischerei-stiefsohn_00000005219477-001 NA           NA           1     high               IPR 1.5c RPS               2050  NA                                 NA                 NA NA      NA            #>  5 fleischerei-stiefsohn_00000005219477-001 NA           NA           0     medium             IPR 1.5c RPS               2050  NA                                 NA                 NA NA      NA            #>  6 fleischerei-stiefsohn_00000005219477-001 NA           NA           0     low                IPR 1.5c RPS               2050  NA                                 NA                 NA NA      NA            #>  7 fleischerei-stiefsohn_00000005219477-001 NA           NA           0     high               announced pledges scenario 2020  NA                                 NA                 NA NA      NA            #>  8 fleischerei-stiefsohn_00000005219477-001 NA           NA           0     medium             announced pledges scenario 2020  NA                                 NA                 NA NA      NA            #>  9 fleischerei-stiefsohn_00000005219477-001 NA           NA           1     low                announced pledges scenario 2020  NA                                 NA                 NA NA      NA            #> 10 fleischerei-stiefsohn_00000005219477-001 NA           NA           0     high               announced pledges scenario 2030  NA                                 NA                 NA NA      NA            #> # ℹ 284 more rows"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/articles/profile_sector_upstream.html","id":"results","dir":"Articles","previous_headings":"","what":"Results","title":"Run profile_sector_upstream()","text":"","code":"# NOTE: If other workflows run before this one, this shows the results of all params$output |> dir_tree() #> ~/Downloads/tilt/output #> ├── emissions_profile_at_company_level.csv #> ├── emissions_profile_at_product_level.csv #> ├── emissions_profile_upstream_at_company_level.csv #> ├── emissions_profile_upstream_at_product_level.csv #> ├── sector_profile_at_company_level.csv #> ├── sector_profile_at_product_level.csv #> ├── sector_profile_upstream_at_company_level.csv #> └── sector_profile_upstream_at_product_level.csv"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/articles/profile_sector_upstream.html","id":"cleanup","dir":"Articles","previous_headings":"","what":"Cleanup","title":"Run profile_sector_upstream()","text":"cache allows resume interruptions. want recompute result, must first delete relevant cache:","code":"# NOTE: If other workflows run before this one, this shows the cache of all dir_tree(user_cache_dir(\"tiltWorkflows\")) #> ~/.cache/tiltWorkflows #> ├── profile_emissions #> │   ├── 1.rds #> │   ├── 2.rds #> │   └── 3.rds #> ├── profile_emissions_upstream #> │   ├── 1.rds #> │   ├── 2.rds #> │   └── 3.rds #> ├── profile_sector #> │   ├── 1.rds #> │   ├── 2.rds #> │   └── 3.rds #> └── profile_sector_upstream #>     ├── 1.rds #>     ├── 2.rds #>     └── 3.rds library(fs) library(rappdirs)  dir_delete(user_cache_dir(\"tiltWorkflows/PROFILE-DIRECTORY-YOU-WANT-TO-DELETE\"))"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Mauro Lepore. Author, maintainer. Kalash Singhal. Author. 2 Degrees Investing Initiative. Copyright holder, funder.","code":""},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Lepore M, Singhal K (2023). tiltWorkflows: Makes Easy Run 'TILT' Workflows. R package version 0.0.0.9010,  https://github.com/2DegreesInvesting/tiltWorkflows, https://2degreesinvesting.github.io/tiltWorkflows/.","code":"@Manual{,   title = {tiltWorkflows: Makes it Easy to Run 'TILT' Workflows},   author = {Mauro Lepore and Kalash Singhal},   year = {2023},   note = {R package version 0.0.0.9010,  https://github.com/2DegreesInvesting/tiltWorkflows},   url = {https://2degreesinvesting.github.io/tiltWorkflows/}, }"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/index.html","id":"tiltworkflows","dir":"","previous_headings":"","what":"Makes it Easy to Run TILT Workflows","title":"Makes it Easy to Run TILT Workflows","text":"goal tiltWorkflows make easy run tilt workflows.","code":""},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Makes it Easy to Run TILT Workflows","text":"can install development version tiltWorkflows like :","code":"# install.packages(\"pak\") pak::pak(\"2DegreesInvesting/tiltWorkflows\")"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/index.html","id":"example","dir":"","previous_headings":"","what":"Example","title":"Makes it Easy to Run TILT Workflows","text":"workflows() shows available workflows. use_workflow() Create workflow file working directory. Knit workflow (consider using parameters). share link output .md file may run gh gist create profile_emissions.md paste contents new GitHub gist.","code":"library(tiltWorkflows) workflows() #> [1] \"profile_emissions_upstream.Rmd\" \"profile_emissions.Rmd\"          #> [3] \"profile_sector_upstream.Rmd\"    \"profile_sector.Rmd\" use_workflow(\"profile_emissions.Rmd\") #> ✔ Setting active project to '/home/rstudio/git/tiltWorkflows' #> ✔ Writing 'profile_emissions.Rmd'"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/profile_emissions.html","id":null,"dir":"Reference","previous_headings":"","what":"Profile emissions and upstream emissions — profile_emissions","title":"Profile emissions and upstream emissions — profile_emissions","text":"functions wrap output corresponding function tiltIndicator.","code":""},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/profile_emissions.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Profile emissions and upstream emissions — profile_emissions","text":"","code":"profile_emissions(   companies,   co2,   europages_companies,   ecoinvent_activities,   ecoinvent_europages,   isic_tilt,   low_threshold = 1/3,   high_threshold = 2/3 )"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/profile_emissions.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Profile emissions and upstream emissions — profile_emissions","text":"companies, co2 dataframe like dataset matching name tiltToyData (see Reference). europages_companies Dataframe. Companies europages. ecoinvent_activities Dataframe. Activities ecoinvent. ecoinvent_europages Dataframe. Mapper europages ecoinvent. isic_tilt Dataframe. Mapper isic tilt. low_threshold numeric value segment low medium transition risk products. high_threshold numeric value segment medium high transition risk products.","code":""},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/profile_emissions.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Profile emissions and upstream emissions — profile_emissions","text":"data frame column companies_id, nested columnsproduct company holding outputs product company level. Unnesting product yields data frame least columns companies_id, grouped_by, risk_category. Unnesting company yields data frame least columns companies_id, grouped_by, risk_category, value.","code":""},{"path":[]},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/profile_emissions.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Profile emissions and upstream emissions — profile_emissions","text":"","code":"library(tiltToyData) library(readr, warn.conflicts = FALSE)  options(readr.show_col_types = FALSE)  companies <- read_csv(toy_emissions_profile_any_companies()) products <- read_csv(toy_emissions_profile_products())  result <- profile_emissions(   companies,   products,   # TODO: Move to tiltToyData   europages_companies = tiltIndicatorAfter::ep_companies,   ecoinvent_activities = tiltIndicatorAfter::ecoinvent_activities,   ecoinvent_europages = tiltIndicatorAfter::matches_mapper |> head(100),   isic_tilt = tiltIndicatorAfter::isic_tilt_mapper )  result |> unnest_product() #> # A tibble: 49 × 26 #>    companies_id     company_name country PCTR_risk_category benchmark ep_product #>    <chr>            <chr>        <chr>   <chr>              <chr>     <chr>      #>  1 fleischerei-sti… NA           NA      high               all       stove      #>  2 fleischerei-sti… NA           NA      high               isic_4di… stove      #>  3 fleischerei-sti… NA           NA      high               tilt_sec… stove      #>  4 fleischerei-sti… NA           NA      high               unit      stove      #>  5 fleischerei-sti… NA           NA      high               unit_isi… stove      #>  6 fleischerei-sti… NA           NA      high               unit_til… stove      #>  7 fleischerei-sti… NA           NA      high               all       oven       #>  8 fleischerei-sti… NA           NA      medium             isic_4di… oven       #>  9 fleischerei-sti… NA           NA      medium             tilt_sec… oven       #> 10 fleischerei-sti… NA           NA      medium             unit      oven       #> # ℹ 39 more rows #> # ℹ 20 more variables: matched_activity_name <chr>, #> #   matched_reference_product <chr>, unit <chr>, multi_match <lgl>, #> #   matching_certainty <chr>, matching_certainty_company_average <chr>, #> #   tilt_sector <chr>, tilt_subsector <chr>, isic_4digit <chr>, #> #   isic_4digit_name <chr>, company_city <chr>, postcode <dbl>, address <chr>, #> #   main_activity <chr>, activity_uuid_product_uuid <chr>, …  result |> unnest_company() #> # A tibble: 129 × 11 #>    companies_id     company_name country PCTR_share PCTR_risk_category benchmark #>    <chr>            <chr>        <chr>        <dbl> <lgl>              <lgl>     #>  1 fleischerei-sti… NA           NA             1   NA                 NA        #>  2 fleischerei-sti… NA           NA             0   NA                 NA        #>  3 fleischerei-sti… NA           NA             0   NA                 NA        #>  4 fleischerei-sti… NA           NA             0.5 NA                 NA        #>  5 fleischerei-sti… NA           NA             0.5 NA                 NA        #>  6 fleischerei-sti… NA           NA             0   NA                 NA        #>  7 fleischerei-sti… NA           NA             0.5 NA                 NA        #>  8 fleischerei-sti… NA           NA             0.5 NA                 NA        #>  9 fleischerei-sti… NA           NA             0   NA                 NA        #> 10 fleischerei-sti… NA           NA             0.5 NA                 NA        #> # ℹ 119 more rows #> # ℹ 5 more variables: matching_certainty_company_average <chr>, #> #   company_city <chr>, postcode <dbl>, address <chr>, main_activity <chr>    inputs <- read_csv(toy_emissions_profile_upstream_products())  result <- profile_emissions_upstream(   companies,   inputs,   # TODO: Move to tiltToyData   europages_companies = tiltIndicatorAfter::ep_companies,   ecoinvent_activities = tiltIndicatorAfter::ecoinvent_activities,   ecoinvent_inputs = tiltIndicatorAfter::ecoinvent_inputs,   ecoinvent_europages = tiltIndicatorAfter::matches_mapper |> head(100),   isic_tilt = tiltIndicatorAfter::isic_tilt_mapper )  result |> unnest_product() #> # A tibble: 319 × 27 #>    companies_id     company_name country ICTR_risk_category benchmark ep_product #>    <chr>            <chr>        <chr>   <chr>              <chr>     <chr>      #>  1 fleischerei-sti… NA           NA      high               all       stove      #>  2 fleischerei-sti… NA           NA      high               all       stove      #>  3 fleischerei-sti… NA           NA      medium             all       stove      #>  4 fleischerei-sti… NA           NA      high               all       stove      #>  5 fleischerei-sti… NA           NA      high               all       stove      #>  6 fleischerei-sti… NA           NA      low                all       stove      #>  7 fleischerei-sti… NA           NA      low                all       stove      #>  8 fleischerei-sti… NA           NA      high               all       stove      #>  9 fleischerei-sti… NA           NA      high               input_is… stove      #> 10 fleischerei-sti… NA           NA      high               input_is… stove      #> # ℹ 309 more rows #> # ℹ 21 more variables: matched_activity_name <chr>, #> #   matched_reference_product <chr>, unit <chr>, multi_match <lgl>, #> #   matching_certainty <chr>, matching_certainty_company_average <chr>, #> #   input_name <chr>, input_unit <chr>, input_tilt_sector <chr>, #> #   input_tilt_subsector <chr>, input_isic_4digit <chr>, #> #   input_isic_4digit_name <chr>, company_city <chr>, postcode <dbl>, …  result |> unnest_company() #> # A tibble: 127 × 11 #>    companies_id  company_name company_city country ICTR_share ICTR_risk_category #>    <chr>         <chr>        <chr>        <chr>        <dbl> <chr>              #>  1 fleischerei-… NA           NA           NA           0.571 high               #>  2 fleischerei-… NA           NA           NA           0.214 medium             #>  3 fleischerei-… NA           NA           NA           0.214 low                #>  4 fleischerei-… NA           NA           NA           0.357 high               #>  5 fleischerei-… NA           NA           NA           0.357 medium             #>  6 fleischerei-… NA           NA           NA           0.286 low                #>  7 fleischerei-… NA           NA           NA           0.429 high               #>  8 fleischerei-… NA           NA           NA           0.357 medium             #>  9 fleischerei-… NA           NA           NA           0.214 low                #> 10 fleischerei-… NA           NA           NA           0.429 high               #> # ℹ 117 more rows #> # ℹ 5 more variables: benchmark <chr>, #> #   matching_certainty_company_average <chr>, postcode <dbl>, address <chr>, #> #   main_activity <chr>"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/profile_emissions_upstream.html","id":null,"dir":"Reference","previous_headings":"","what":"Profile emissions and upstream emissions — profile_emissions_upstream","title":"Profile emissions and upstream emissions — profile_emissions_upstream","text":"functions wrap output corresponding function tiltIndicator.","code":""},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/profile_emissions_upstream.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Profile emissions and upstream emissions — profile_emissions_upstream","text":"","code":"profile_emissions_upstream(   companies,   co2,   europages_companies,   ecoinvent_activities,   ecoinvent_inputs,   ecoinvent_europages,   isic_tilt,   low_threshold = 1/3,   high_threshold = 2/3 )"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/profile_emissions_upstream.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Profile emissions and upstream emissions — profile_emissions_upstream","text":"companies, co2 dataframe like dataset matching name tiltToyData (see Reference). europages_companies Dataframe. Companies europages. ecoinvent_activities Dataframe. Activities ecoinvent. ecoinvent_inputs Dataframe. Upstream products ecoinvent. ecoinvent_europages Dataframe. Mapper europages ecoinvent. isic_tilt Dataframe. Mapper isic tilt. low_threshold numeric value segment low medium transition risk products. high_threshold numeric value segment medium high transition risk products.","code":""},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/profile_emissions_upstream.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Profile emissions and upstream emissions — profile_emissions_upstream","text":"data frame column companies_id, nested columnsproduct company holding outputs product company level. Unnesting product yields data frame least columns companies_id, grouped_by, risk_category. Unnesting company yields data frame least columns companies_id, grouped_by, risk_category, value.","code":""},{"path":[]},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/profile_emissions_upstream.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Profile emissions and upstream emissions — profile_emissions_upstream","text":"","code":"library(tiltToyData) library(readr, warn.conflicts = FALSE)  options(readr.show_col_types = FALSE)  companies <- read_csv(toy_emissions_profile_any_companies()) products <- read_csv(toy_emissions_profile_products())  result <- profile_emissions(   companies,   products,   # TODO: Move to tiltToyData   europages_companies = tiltIndicatorAfter::ep_companies,   ecoinvent_activities = tiltIndicatorAfter::ecoinvent_activities,   ecoinvent_europages = tiltIndicatorAfter::matches_mapper |> head(100),   isic_tilt = tiltIndicatorAfter::isic_tilt_mapper )  result |> unnest_product() #> # A tibble: 49 × 26 #>    companies_id     company_name country PCTR_risk_category benchmark ep_product #>    <chr>            <chr>        <chr>   <chr>              <chr>     <chr>      #>  1 fleischerei-sti… NA           NA      high               all       stove      #>  2 fleischerei-sti… NA           NA      high               isic_4di… stove      #>  3 fleischerei-sti… NA           NA      high               tilt_sec… stove      #>  4 fleischerei-sti… NA           NA      high               unit      stove      #>  5 fleischerei-sti… NA           NA      high               unit_isi… stove      #>  6 fleischerei-sti… NA           NA      high               unit_til… stove      #>  7 fleischerei-sti… NA           NA      high               all       oven       #>  8 fleischerei-sti… NA           NA      medium             isic_4di… oven       #>  9 fleischerei-sti… NA           NA      medium             tilt_sec… oven       #> 10 fleischerei-sti… NA           NA      medium             unit      oven       #> # ℹ 39 more rows #> # ℹ 20 more variables: matched_activity_name <chr>, #> #   matched_reference_product <chr>, unit <chr>, multi_match <lgl>, #> #   matching_certainty <chr>, matching_certainty_company_average <chr>, #> #   tilt_sector <chr>, tilt_subsector <chr>, isic_4digit <chr>, #> #   isic_4digit_name <chr>, company_city <chr>, postcode <dbl>, address <chr>, #> #   main_activity <chr>, activity_uuid_product_uuid <chr>, …  result |> unnest_company() #> # A tibble: 129 × 11 #>    companies_id     company_name country PCTR_share PCTR_risk_category benchmark #>    <chr>            <chr>        <chr>        <dbl> <lgl>              <lgl>     #>  1 fleischerei-sti… NA           NA             1   NA                 NA        #>  2 fleischerei-sti… NA           NA             0   NA                 NA        #>  3 fleischerei-sti… NA           NA             0   NA                 NA        #>  4 fleischerei-sti… NA           NA             0.5 NA                 NA        #>  5 fleischerei-sti… NA           NA             0.5 NA                 NA        #>  6 fleischerei-sti… NA           NA             0   NA                 NA        #>  7 fleischerei-sti… NA           NA             0.5 NA                 NA        #>  8 fleischerei-sti… NA           NA             0.5 NA                 NA        #>  9 fleischerei-sti… NA           NA             0   NA                 NA        #> 10 fleischerei-sti… NA           NA             0.5 NA                 NA        #> # ℹ 119 more rows #> # ℹ 5 more variables: matching_certainty_company_average <chr>, #> #   company_city <chr>, postcode <dbl>, address <chr>, main_activity <chr>    inputs <- read_csv(toy_emissions_profile_upstream_products())  result <- profile_emissions_upstream(   companies,   inputs,   # TODO: Move to tiltToyData   europages_companies = tiltIndicatorAfter::ep_companies,   ecoinvent_activities = tiltIndicatorAfter::ecoinvent_activities,   ecoinvent_inputs = tiltIndicatorAfter::ecoinvent_inputs,   ecoinvent_europages = tiltIndicatorAfter::matches_mapper |> head(100),   isic_tilt = tiltIndicatorAfter::isic_tilt_mapper )  result |> unnest_product() #> # A tibble: 319 × 27 #>    companies_id     company_name country ICTR_risk_category benchmark ep_product #>    <chr>            <chr>        <chr>   <chr>              <chr>     <chr>      #>  1 fleischerei-sti… NA           NA      high               all       stove      #>  2 fleischerei-sti… NA           NA      high               all       stove      #>  3 fleischerei-sti… NA           NA      medium             all       stove      #>  4 fleischerei-sti… NA           NA      high               all       stove      #>  5 fleischerei-sti… NA           NA      high               all       stove      #>  6 fleischerei-sti… NA           NA      low                all       stove      #>  7 fleischerei-sti… NA           NA      low                all       stove      #>  8 fleischerei-sti… NA           NA      high               all       stove      #>  9 fleischerei-sti… NA           NA      high               input_is… stove      #> 10 fleischerei-sti… NA           NA      high               input_is… stove      #> # ℹ 309 more rows #> # ℹ 21 more variables: matched_activity_name <chr>, #> #   matched_reference_product <chr>, unit <chr>, multi_match <lgl>, #> #   matching_certainty <chr>, matching_certainty_company_average <chr>, #> #   input_name <chr>, input_unit <chr>, input_tilt_sector <chr>, #> #   input_tilt_subsector <chr>, input_isic_4digit <chr>, #> #   input_isic_4digit_name <chr>, company_city <chr>, postcode <dbl>, …  result |> unnest_company() #> # A tibble: 127 × 11 #>    companies_id  company_name company_city country ICTR_share ICTR_risk_category #>    <chr>         <chr>        <chr>        <chr>        <dbl> <chr>              #>  1 fleischerei-… NA           NA           NA           0.571 high               #>  2 fleischerei-… NA           NA           NA           0.214 medium             #>  3 fleischerei-… NA           NA           NA           0.214 low                #>  4 fleischerei-… NA           NA           NA           0.357 high               #>  5 fleischerei-… NA           NA           NA           0.357 medium             #>  6 fleischerei-… NA           NA           NA           0.286 low                #>  7 fleischerei-… NA           NA           NA           0.429 high               #>  8 fleischerei-… NA           NA           NA           0.357 medium             #>  9 fleischerei-… NA           NA           NA           0.214 low                #> 10 fleischerei-… NA           NA           NA           0.429 high               #> # ℹ 117 more rows #> # ℹ 5 more variables: benchmark <chr>, #> #   matching_certainty_company_average <chr>, postcode <dbl>, address <chr>, #> #   main_activity <chr>"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/profile_sector.html","id":null,"dir":"Reference","previous_headings":"","what":"Profile sector and upstream sector — profile_sector","title":"Profile sector and upstream sector — profile_sector","text":"functions wrap output corresponding function tiltIndicator.","code":""},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/profile_sector.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Profile sector and upstream sector — profile_sector","text":"","code":"profile_sector(   companies,   scenarios,   europages_companies,   ecoinvent_activities,   ecoinvent_europages,   isic_tilt,   low_threshold = ifelse(scenarios$year == 2030, 1/9, 1/3),   high_threshold = ifelse(scenarios$year == 2030, 2/9, 2/3) )"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/profile_sector.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Profile sector and upstream sector — profile_sector","text":"europages_companies Dataframe. Companies europages. ecoinvent_activities Dataframe. Activities ecoinvent. ecoinvent_europages Dataframe. Mapper europages ecoinvent. isic_tilt Dataframe. Mapper isic tilt. low_threshold numeric value segment low medium transition risk products. high_threshold numeric value segment medium high transition risk products.","code":""},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/profile_sector.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Profile sector and upstream sector — profile_sector","text":"data frame column companies_id, nested columnsproduct company holding outputs product company level. Unnesting product yields data frame least columns companies_id, grouped_by, risk_category. Unnesting company yields data frame least columns companies_id, grouped_by, risk_category, value.","code":""},{"path":[]},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/profile_sector.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Profile sector and upstream sector — profile_sector","text":"","code":"library(tiltToyData) library(readr, warn.conflicts = FALSE)  options(readr.show_col_types = FALSE)  companies <- read_csv(toy_sector_profile_companies()) scenarios <- read_csv(toy_sector_profile_any_scenarios())  result <- profile_sector(   companies,   scenarios,   # TODO: Move to tiltToyData   europages_companies = ep_companies |> head(3),   ecoinvent_activities = ecoinvent_activities |> head(3),   ecoinvent_europages = matches_mapper |> head(3),   isic_tilt = isic_tilt_mapper |> head(3) )  result |> unnest_product() #> # A tibble: 196 × 28 #>    companies_id           company_name country PSTR_risk_category scenario  year #>    <chr>                  <chr>        <chr>   <chr>              <chr>    <dbl> #>  1 fleischerei-stiefsohn… NA           NA      high               IPR 1.5…  2030 #>  2 fleischerei-stiefsohn… NA           NA      high               IPR 1.5…  2050 #>  3 fleischerei-stiefsohn… NA           NA      low                stated …  2020 #>  4 fleischerei-stiefsohn… NA           NA      low                announc…  2020 #>  5 fleischerei-stiefsohn… NA           NA      low                net zer…  2020 #>  6 fleischerei-stiefsohn… NA           NA      low                stated …  2030 #>  7 fleischerei-stiefsohn… NA           NA      low                announc…  2030 #>  8 fleischerei-stiefsohn… NA           NA      high               net zer…  2030 #>  9 fleischerei-stiefsohn… NA           NA      low                stated …  2040 #> 10 fleischerei-stiefsohn… NA           NA      medium             announc…  2040 #> # ℹ 186 more rows #> # ℹ 22 more variables: ep_product <chr>, matched_activity_name <chr>, #> #   matched_reference_product <chr>, unit <chr>, tilt_sector <chr>, #> #   tilt_subsector <chr>, multi_match <lgl>, matching_certainty <chr>, #> #   matching_certainty_company_average <chr>, company_city <chr>, #> #   postcode <dbl>, address <chr>, main_activity <chr>, #> #   activity_uuid_product_uuid <chr>, profile_ranking <dbl>, …  result |> unnest_company() #> # A tibble: 588 × 12 #>    companies_id      company_name country PSTR_share PSTR_risk_category scenario #>    <chr>             <chr>        <chr>        <dbl> <chr>              <chr>    #>  1 fleischerei-stie… NA           NA               1 high               IPR 1.5… #>  2 fleischerei-stie… NA           NA               0 medium             IPR 1.5… #>  3 fleischerei-stie… NA           NA               0 low                IPR 1.5… #>  4 fleischerei-stie… NA           NA               1 high               IPR 1.5… #>  5 fleischerei-stie… NA           NA               0 medium             IPR 1.5… #>  6 fleischerei-stie… NA           NA               0 low                IPR 1.5… #>  7 fleischerei-stie… NA           NA               0 high               announc… #>  8 fleischerei-stie… NA           NA               0 medium             announc… #>  9 fleischerei-stie… NA           NA               1 low                announc… #> 10 fleischerei-stie… NA           NA               0 high               announc… #> # ℹ 578 more rows #> # ℹ 6 more variables: year <chr>, matching_certainty_company_average <chr>, #> #   company_city <chr>, postcode <dbl>, address <chr>, main_activity <chr>    companies <- read_csv(toy_sector_profile_upstream_companies()) scenarios <- read_csv(toy_sector_profile_any_scenarios()) inputs <- read_csv(toy_sector_profile_upstream_products()) ecoinvent_inputs <- ecoinvent_inputs |> head(3)  result <- profile_sector_upstream(   companies,   scenarios,   inputs,   # TODO: Move to tiltToyData   europages_companies = ep_companies |> head(3),   ecoinvent_activities = ecoinvent_activities |> head(3),   ecoinvent_inputs = ecoinvent_inputs |> head(3),   ecoinvent_europages = matches_mapper |> head(3),   isic_tilt = isic_tilt_mapper |> head(3) )  result |> unnest_product() #> # A tibble: 704 × 31 #>    companies_id           company_name country ISTR_risk_category scenario  year #>    <chr>                  <chr>        <chr>   <chr>              <chr>    <dbl> #>  1 fleischerei-stiefsohn… NA           NA      low                stated …  2020 #>  2 fleischerei-stiefsohn… NA           NA      low                stated …  2030 #>  3 fleischerei-stiefsohn… NA           NA      low                stated …  2040 #>  4 fleischerei-stiefsohn… NA           NA      low                stated …  2050 #>  5 fleischerei-stiefsohn… NA           NA      low                announc…  2020 #>  6 fleischerei-stiefsohn… NA           NA      high               announc…  2030 #>  7 fleischerei-stiefsohn… NA           NA      high               announc…  2040 #>  8 fleischerei-stiefsohn… NA           NA      high               announc…  2050 #>  9 fleischerei-stiefsohn… NA           NA      low                net zer…  2020 #> 10 fleischerei-stiefsohn… NA           NA      high               net zer…  2030 #> # ℹ 694 more rows #> # ℹ 25 more variables: ep_product <chr>, matched_activity_name <chr>, #> #   matched_reference_product <chr>, unit <chr>, tilt_sector <chr>, #> #   multi_match <lgl>, matching_certainty <chr>, #> #   matching_certainty_company_average <chr>, input_name <chr>, #> #   input_unit <chr>, input_tilt_sector <chr>, input_tilt_subsector <chr>, #> #   company_city <chr>, postcode <dbl>, address <chr>, main_activity <chr>, …  result |> unnest_company() #> # A tibble: 294 × 12 #>    companies_id      company_name country ISTR_share ISTR_risk_category scenario #>    <chr>             <chr>        <chr>        <dbl> <chr>              <chr>    #>  1 fleischerei-stie… NA           NA          0.333  high               IPR 1.5… #>  2 fleischerei-stie… NA           NA          0.583  medium             IPR 1.5… #>  3 fleischerei-stie… NA           NA          0.0833 low                IPR 1.5… #>  4 fleischerei-stie… NA           NA          1      high               IPR 1.5… #>  5 fleischerei-stie… NA           NA          0      medium             IPR 1.5… #>  6 fleischerei-stie… NA           NA          0      low                IPR 1.5… #>  7 fleischerei-stie… NA           NA          0      high               announc… #>  8 fleischerei-stie… NA           NA          0      medium             announc… #>  9 fleischerei-stie… NA           NA          1      low                announc… #> 10 fleischerei-stie… NA           NA          0.0769 high               announc… #> # ℹ 284 more rows #> # ℹ 6 more variables: year <chr>, matching_certainty_company_average <chr>, #> #   company_city <chr>, postcode <dbl>, address <chr>, main_activity <chr>"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/profile_sector_upstream.html","id":null,"dir":"Reference","previous_headings":"","what":"Profile sector and upstream sector — profile_sector_upstream","title":"Profile sector and upstream sector — profile_sector_upstream","text":"functions wrap output corresponding function tiltIndicator.","code":""},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/profile_sector_upstream.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Profile sector and upstream sector — profile_sector_upstream","text":"","code":"profile_sector_upstream(   companies,   scenarios,   inputs,   europages_companies,   ecoinvent_activities,   ecoinvent_inputs,   ecoinvent_europages,   isic_tilt,   low_threshold = ifelse(scenarios$year == 2030, 1/9, 1/3),   high_threshold = ifelse(scenarios$year == 2030, 2/9, 2/3) )"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/profile_sector_upstream.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Profile sector and upstream sector — profile_sector_upstream","text":"companies, scenarios, inputs dataframe like dataset matching name tiltToyData (see Reference). europages_companies Dataframe. Companies europages. ecoinvent_activities Dataframe. Activities ecoinvent. ecoinvent_inputs Dataframe. Upstream products ecoinvent. ecoinvent_europages Dataframe. Mapper europages ecoinvent. isic_tilt Dataframe. Mapper isic tilt. low_threshold numeric value segment low medium transition risk products. high_threshold numeric value segment medium high transition risk products.","code":""},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/profile_sector_upstream.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Profile sector and upstream sector — profile_sector_upstream","text":"data frame column companies_id, nested columnsproduct company holding outputs product company level. Unnesting product yields data frame least columns companies_id, grouped_by, risk_category. Unnesting company yields data frame least columns companies_id, grouped_by, risk_category, value.","code":""},{"path":[]},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/profile_sector_upstream.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Profile sector and upstream sector — profile_sector_upstream","text":"","code":"library(tiltToyData) library(readr, warn.conflicts = FALSE)  options(readr.show_col_types = FALSE)  companies <- read_csv(toy_sector_profile_companies()) scenarios <- read_csv(toy_sector_profile_any_scenarios())  result <- profile_sector(   companies,   scenarios,   # TODO: Move to tiltToyData   europages_companies = ep_companies |> head(3),   ecoinvent_activities = ecoinvent_activities |> head(3),   ecoinvent_europages = matches_mapper |> head(3),   isic_tilt = isic_tilt_mapper |> head(3) )  result |> unnest_product() #> # A tibble: 196 × 28 #>    companies_id           company_name country PSTR_risk_category scenario  year #>    <chr>                  <chr>        <chr>   <chr>              <chr>    <dbl> #>  1 fleischerei-stiefsohn… NA           NA      high               IPR 1.5…  2030 #>  2 fleischerei-stiefsohn… NA           NA      high               IPR 1.5…  2050 #>  3 fleischerei-stiefsohn… NA           NA      low                stated …  2020 #>  4 fleischerei-stiefsohn… NA           NA      low                announc…  2020 #>  5 fleischerei-stiefsohn… NA           NA      low                net zer…  2020 #>  6 fleischerei-stiefsohn… NA           NA      low                stated …  2030 #>  7 fleischerei-stiefsohn… NA           NA      low                announc…  2030 #>  8 fleischerei-stiefsohn… NA           NA      high               net zer…  2030 #>  9 fleischerei-stiefsohn… NA           NA      low                stated …  2040 #> 10 fleischerei-stiefsohn… NA           NA      medium             announc…  2040 #> # ℹ 186 more rows #> # ℹ 22 more variables: ep_product <chr>, matched_activity_name <chr>, #> #   matched_reference_product <chr>, unit <chr>, tilt_sector <chr>, #> #   tilt_subsector <chr>, multi_match <lgl>, matching_certainty <chr>, #> #   matching_certainty_company_average <chr>, company_city <chr>, #> #   postcode <dbl>, address <chr>, main_activity <chr>, #> #   activity_uuid_product_uuid <chr>, profile_ranking <dbl>, …  result |> unnest_company() #> # A tibble: 588 × 12 #>    companies_id      company_name country PSTR_share PSTR_risk_category scenario #>    <chr>             <chr>        <chr>        <dbl> <chr>              <chr>    #>  1 fleischerei-stie… NA           NA               1 high               IPR 1.5… #>  2 fleischerei-stie… NA           NA               0 medium             IPR 1.5… #>  3 fleischerei-stie… NA           NA               0 low                IPR 1.5… #>  4 fleischerei-stie… NA           NA               1 high               IPR 1.5… #>  5 fleischerei-stie… NA           NA               0 medium             IPR 1.5… #>  6 fleischerei-stie… NA           NA               0 low                IPR 1.5… #>  7 fleischerei-stie… NA           NA               0 high               announc… #>  8 fleischerei-stie… NA           NA               0 medium             announc… #>  9 fleischerei-stie… NA           NA               1 low                announc… #> 10 fleischerei-stie… NA           NA               0 high               announc… #> # ℹ 578 more rows #> # ℹ 6 more variables: year <chr>, matching_certainty_company_average <chr>, #> #   company_city <chr>, postcode <dbl>, address <chr>, main_activity <chr>    companies <- read_csv(toy_sector_profile_upstream_companies()) scenarios <- read_csv(toy_sector_profile_any_scenarios()) inputs <- read_csv(toy_sector_profile_upstream_products()) ecoinvent_inputs <- ecoinvent_inputs |> head(3)  result <- profile_sector_upstream(   companies,   scenarios,   inputs,   # TODO: Move to tiltToyData   europages_companies = ep_companies |> head(3),   ecoinvent_activities = ecoinvent_activities |> head(3),   ecoinvent_inputs = ecoinvent_inputs |> head(3),   ecoinvent_europages = matches_mapper |> head(3),   isic_tilt = isic_tilt_mapper |> head(3) )  result |> unnest_product() #> # A tibble: 704 × 31 #>    companies_id           company_name country ISTR_risk_category scenario  year #>    <chr>                  <chr>        <chr>   <chr>              <chr>    <dbl> #>  1 fleischerei-stiefsohn… NA           NA      low                stated …  2020 #>  2 fleischerei-stiefsohn… NA           NA      low                stated …  2030 #>  3 fleischerei-stiefsohn… NA           NA      low                stated …  2040 #>  4 fleischerei-stiefsohn… NA           NA      low                stated …  2050 #>  5 fleischerei-stiefsohn… NA           NA      low                announc…  2020 #>  6 fleischerei-stiefsohn… NA           NA      high               announc…  2030 #>  7 fleischerei-stiefsohn… NA           NA      high               announc…  2040 #>  8 fleischerei-stiefsohn… NA           NA      high               announc…  2050 #>  9 fleischerei-stiefsohn… NA           NA      low                net zer…  2020 #> 10 fleischerei-stiefsohn… NA           NA      high               net zer…  2030 #> # ℹ 694 more rows #> # ℹ 25 more variables: ep_product <chr>, matched_activity_name <chr>, #> #   matched_reference_product <chr>, unit <chr>, tilt_sector <chr>, #> #   multi_match <lgl>, matching_certainty <chr>, #> #   matching_certainty_company_average <chr>, input_name <chr>, #> #   input_unit <chr>, input_tilt_sector <chr>, input_tilt_subsector <chr>, #> #   company_city <chr>, postcode <dbl>, address <chr>, main_activity <chr>, …  result |> unnest_company() #> # A tibble: 294 × 12 #>    companies_id      company_name country ISTR_share ISTR_risk_category scenario #>    <chr>             <chr>        <chr>        <dbl> <chr>              <chr>    #>  1 fleischerei-stie… NA           NA          0.333  high               IPR 1.5… #>  2 fleischerei-stie… NA           NA          0.583  medium             IPR 1.5… #>  3 fleischerei-stie… NA           NA          0.0833 low                IPR 1.5… #>  4 fleischerei-stie… NA           NA          1      high               IPR 1.5… #>  5 fleischerei-stie… NA           NA          0      medium             IPR 1.5… #>  6 fleischerei-stie… NA           NA          0      low                IPR 1.5… #>  7 fleischerei-stie… NA           NA          0      high               announc… #>  8 fleischerei-stie… NA           NA          0      medium             announc… #>  9 fleischerei-stie… NA           NA          1      low                announc… #> 10 fleischerei-stie… NA           NA          0.0769 high               announc… #> # ℹ 284 more rows #> # ℹ 6 more variables: year <chr>, matching_certainty_company_average <chr>, #> #   company_city <chr>, postcode <dbl>, address <chr>, main_activity <chr>"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/read_csv_falling_back_to.html","id":null,"dir":"Reference","previous_headings":"","what":"Read a .csv file; if it doesn't exist, fall back to another dataset — read_csv_falling_back_to","title":"Read a .csv file; if it doesn't exist, fall back to another dataset — read_csv_falling_back_to","text":"Read .csv file; exist, fall back another dataset","code":""},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/read_csv_falling_back_to.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Read a .csv file; if it doesn't exist, fall back to another dataset — read_csv_falling_back_to","text":"","code":"read_csv_falling_back_to(path, data)"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/read_csv_falling_back_to.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Read a .csv file; if it doesn't exist, fall back to another dataset — read_csv_falling_back_to","text":"path Character. path .csv file. data Data frame. dataset fall back .csv file exist.","code":""},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/read_csv_falling_back_to.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Read a .csv file; if it doesn't exist, fall back to another dataset — read_csv_falling_back_to","text":"data frame.","code":""},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/read_csv_falling_back_to.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Read a .csv file; if it doesn't exist, fall back to another dataset — read_csv_falling_back_to","text":"","code":"read_csv_falling_back_to(\"/does/not/exist.csv\", head(cars)) #> Warning: Using head(cars) #>   speed dist #> 1     4    2 #> 2     4   10 #> 3     7    4 #> 4     7   22 #> 5     8   16 #> 6     9   10"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/tiltWorkflows-package.html","id":null,"dir":"Reference","previous_headings":"","what":"tiltWorkflows: Makes it Easy to Run 'TILT' Workflows — tiltWorkflows-package","title":"tiltWorkflows: Makes it Easy to Run 'TILT' Workflows — tiltWorkflows-package","text":"Makes easy run 'tilt' workflows.","code":""},{"path":[]},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/tiltWorkflows-package.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"tiltWorkflows: Makes it Easy to Run 'TILT' Workflows — tiltWorkflows-package","text":"Maintainer: Mauro Lepore maurolepore@gmail.com (ORCID) Authors: Kalash Singhal kalash@2degrees-investing.org contributors: 2 Degrees Investing Initiative contact@2degrees-investing.org [copyright holder, funder]","code":""},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/use_workflow.html","id":null,"dir":"Reference","previous_headings":"","what":"List and use workflows — use_workflow","title":"List and use workflows — use_workflow","text":"workflows() lists available workflows. use_workflow() creates workflow file template tiltWorkflows package.","code":""},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/use_workflow.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"List and use workflows — use_workflow","text":"","code":"use_workflow(template, save_as = template, open = rlang::is_interactive())  workflows()"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/use_workflow.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"List and use workflows — use_workflow","text":"template Path template file relative templates/ directory within package; see details. save_as Path file create, relative root active project. Defaults template open Open newly created file editing? Happens RStudio, applicable, via utils::file.edit() otherwise.","code":""},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/use_workflow.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"List and use workflows — use_workflow","text":"logical vector indicating file modified.","code":""},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/reference/use_workflow.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"List and use workflows — use_workflow","text":"","code":"workflows() #> [1] \"profile_emissions.Rmd\"          \"profile_emissions_upstream.Rmd\" #> [3] \"profile_sector.Rmd\"             \"profile_sector_upstream.Rmd\"     if (FALSE) { # Note: Running this will write \"profile_emissions.Rmd\" to your working directory use_workflow(\"profile_emissions.Rmd\") }"},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/news/index.html","id":"tiltworkflows-0009010-2023-12-14","dir":"Changelog","previous_headings":"","what":"tiltWorkflows 0.0.0.9010 (2023-12-14)","title":"tiltWorkflows 0.0.0.9010 (2023-12-14)","text":"workflow files now output github_document (#30). makes easy user share output GitHub.","code":""},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/news/index.html","id":"tiltworkflows-0009009-2023-12-13","dir":"Changelog","previous_headings":"","what":"tiltWorkflows 0.0.0.9009 (2023-12-13)","title":"tiltWorkflows 0.0.0.9009 (2023-12-13)","text":"use_workflow() now automatically opens workflow file interactive sessions (#21).","code":""},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/news/index.html","id":"tiltworkflows-0009008-2023-12-13","dir":"Changelog","previous_headings":"","what":"tiltWorkflows 0.0.0.9008 (2023-12-13)","title":"tiltWorkflows 0.0.0.9008 (2023-12-13)","text":"Workflows now split indicator, run chunks (#20). split indicator allows user granular control want run. computations chunk run parallel caching intermediate results, process completes faster, saves memory, allows resuming interruptions.","code":""},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/news/index.html","id":"tiltworkflows-0009007-2023-12-08","dir":"Changelog","previous_headings":"","what":"tiltWorkflows 0.0.0.9007 (2023-12-08)","title":"tiltWorkflows 0.0.0.9007 (2023-12-08)","text":"Parametrize workflow tilt-profiles.Rmd (#14). helps users pass data via graphical user interface, without changing code.","code":""},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/news/index.html","id":"tiltworkflows-0009006-2023-12-08","dir":"Changelog","previous_headings":"","what":"tiltWorkflows 0.0.0.9006 (2023-12-08)","title":"tiltWorkflows 0.0.0.9006 (2023-12-08)","text":"workflow “tilt profiles” now reproducible toy data (#6).","code":""},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/news/index.html","id":"tiltworkflows-0009005-2023-12-08","dir":"Changelog","previous_headings":"","what":"tiltWorkflows 0.0.0.9005 (2023-12-08)","title":"tiltWorkflows 0.0.0.9005 (2023-12-08)","text":"New article: Use parameters (#12).","code":""},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/news/index.html","id":"tiltworkflows-0009004-2023-12-07","dir":"Changelog","previous_headings":"","what":"tiltWorkflows 0.0.0.9004 (2023-12-07)","title":"tiltWorkflows 0.0.0.9004 (2023-12-07)","text":"Depend tiltToyData (#8). makes toy datasets available user automatically call library(tiltWorkflows).","code":""},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/news/index.html","id":"tiltworkflows-0009003-2023-12-07","dir":"Changelog","previous_headings":"","what":"tiltWorkflows 0.0.0.9003 (2023-12-07)","title":"tiltWorkflows 0.0.0.9003 (2023-12-07)","text":"Depend tiltIndicatorAfter (#7). makes tiltWorkflows user friendly since ’s package users need install use – everything else happens behind hoods.","code":""},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/news/index.html","id":"tiltworkflows-0009002-2023-12-07","dir":"Changelog","previous_headings":"","what":"tiltWorkflows 0.0.0.9002 (2023-12-07)","title":"tiltWorkflows 0.0.0.9002 (2023-12-07)","text":"New use_workflow() helps users create workflow file template (#5).","code":""},{"path":"https://2degreesinvesting.github.io/tiltWorkflows/news/index.html","id":"tiltworkflows-0009001-2023-12-06","dir":"Changelog","previous_headings":"","what":"tiltWorkflows 0.0.0.9001 (2023-12-06)","title":"tiltWorkflows 0.0.0.9001 (2023-12-06)","text":"New article “Get started” (#4 @kalashsinghal).","code":""}]
