<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>profile_emissions_upstream.Rmd • tiltWorkflows</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="profile_emissions_upstream.Rmd">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tiltWorkflows</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9033</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/tiltWorkflows.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-workflows" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Workflows</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-workflows">
<li><a class="dropdown-item" href="../articles/profile_emissions.html">profile_emissions.Rmd</a></li>
    <li><a class="dropdown-item" href="../articles/profile_emissions_upstream.html">profile_emissions_upstream.Rmd</a></li>
    <li><a class="dropdown-item" href="../articles/profile_sector.html">profile_sector.Rmd</a></li>
    <li><a class="dropdown-item" href="../articles/profile_sector_upstream.html">profile_sector_upstream.Rmd</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/2DegreesInvesting/tiltWorkflows/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>profile_emissions_upstream.Rmd</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/2DegreesInvesting/tiltWorkflows/blob/main/vignettes/articles/profile_emissions_upstream.Rmd" class="external-link"><code>vignettes/articles/profile_emissions_upstream.Rmd</code></a></small>
      <div class="d-none name"><code>profile_emissions_upstream.Rmd</code></div>
    </div>

    
    
<!-- This file is generated from inst/extdata. Please edit that file -->
<p>This workflow runs in chunks of the <code>*companies</code> data and
caches intermediate results. This saves memory, completes faster, and
allows you to resume after interruptions.</p>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rappdirs.r-lib.org" class="external-link">rappdirs</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://fs.r-lib.org" class="external-link">fs</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Masking `tiltIndicatorAfter::profile*()` to use `chunks`</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://2degreesinvesting.github.io/tiltWorkflows/">tiltWorkflows</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: tiltIndicatorAfter</span></span>
<span><span class="co">#&gt; Loading required package: tiltToyData</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'tiltWorkflows'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:tiltIndicatorAfter':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     profile_emissions, profile_emissions_upstream, profile_sector,</span></span>
<span><span class="co">#&gt;     profile_sector_upstream</span></span></code></pre></div>
<p>If the parameter <code>chunks</code> is <code>NULL</code> (default)
your <code>*companies</code> dataset is automatically chunked to
distribute its companies across available cores. This uses your computer
resources efficiently but may not be enough. Consider adjusting the
<code>chunks</code> parameter manually. Aim to balance memory-usage and
speed. A small number of <code>chunks</code> makes each chunk bigger and
may overwhelm your memory. A large number of <code>chunks</code> may
take longer because of the overhead of caching each chunk.</p>
<details><summary>
Parameters
</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">params</span></span>
<span><span class="co">#&gt; $chunks</span></span>
<span><span class="co">#&gt; [1] ""</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $order</span></span>
<span><span class="co">#&gt; [1] "sample"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $cache_dir</span></span>
<span><span class="co">#&gt; [1] ""</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $input</span></span>
<span><span class="co">#&gt; [1] "input"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $output</span></span>
<span><span class="co">#&gt; [1] "output"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $europages_companies</span></span>
<span><span class="co">#&gt; [1] "europages_companies.csv"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ecoinvent_activities</span></span>
<span><span class="co">#&gt; [1] "ecoinvent_activities.csv"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ecoinvent_europages</span></span>
<span><span class="co">#&gt; [1] "ecoinvent_europages.csv"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $isic</span></span>
<span><span class="co">#&gt; [1] "isic.csv"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $emissions_profile_any_companies</span></span>
<span><span class="co">#&gt; [1] "emissions_profile_any_companies.csv"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $emissions_profile_upstream_products</span></span>
<span><span class="co">#&gt; [1] "emissions_profile_upstream_products.csv"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ecoinvent_inputs</span></span>
<span><span class="co">#&gt; [1] "ecoinvent_inputs.csv"</span></span></code></pre></div>
</details><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span></span>
<span>  <span class="co"># Determines the number of chunks</span></span>
<span>  tiltWorkflows.chunks <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">chunks</span>,</span>
<span>  <span class="co"># Determines the order in which the chunks run</span></span>
<span>  tiltWorkflows.order <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">order</span>,</span>
<span>  <span class="co"># Determines where to store the cache</span></span>
<span>  tiltWorkflows.cache_dir <span class="op">=</span> <span class="va">params</span><span class="op">$</span><span class="va">cache_dir</span>,</span>
<span>  <span class="co"># Read data quietly</span></span>
<span>  readr.show_col_types <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="co"># Make printed output wider</span></span>
<span>  width <span class="op">=</span> <span class="fl">500</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Enable computing over multiple workers in parallel</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Ensure input/ and output/ directories</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://fs.r-lib.org/reference/file_access.html" class="external-link">dir_exists</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">input</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="../reference/use_toy_input.html">use_toy_input</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Writing input/ with toy datasets.</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://fs.r-lib.org/reference/file_access.html" class="external-link">dir_exists</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">output</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://fs.r-lib.org/reference/create.html" class="external-link">dir_create</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">output</span><span class="op">)</span></span></code></pre></div>
<details><summary>
Session information
</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/home/runner/work/tiltWorkflows/tiltWorkflows/vignettes/articles"</span></span>
<span></span>
<span><span class="fu"><a href="https://parallelly.futureverse.org/reference/availableCores.html" class="external-link">availableCores</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; system </span></span>
<span><span class="co">#&gt;      4</span></span>
<span></span>
<span><span class="fu"><a href="https://fs.r-lib.org/reference/dir_tree.html" class="external-link">dir_tree</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">input</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">input</span></span></span>
<span><span class="co">#&gt; ├── ecoinvent_activities.csv</span></span>
<span><span class="co">#&gt; ├── ecoinvent_europages.csv</span></span>
<span><span class="co">#&gt; ├── ecoinvent_inputs.csv</span></span>
<span><span class="co">#&gt; ├── emissions_profile_any_companies.csv</span></span>
<span><span class="co">#&gt; ├── emissions_profile_products.csv</span></span>
<span><span class="co">#&gt; ├── emissions_profile_upstream_products.csv</span></span>
<span><span class="co">#&gt; ├── europages_companies.csv</span></span>
<span><span class="co">#&gt; ├── isic.csv</span></span>
<span><span class="co">#&gt; ├── sector_profile_any_scenarios.csv</span></span>
<span><span class="co">#&gt; ├── sector_profile_companies.csv</span></span>
<span><span class="co">#&gt; ├── sector_profile_upstream_companies.csv</span></span>
<span><span class="co">#&gt; └── sector_profile_upstream_products.csv</span></span>
<span></span>
<span><span class="fu"><a href="https://fs.r-lib.org/reference/dir_tree.html" class="external-link">dir_tree</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">output</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">output</span></span></span>
<span></span>
<span><span class="fu">sessioninfo</span><span class="fu">::</span><span class="fu"><a href="https://r-lib.github.io/sessioninfo/reference/session_info.html" class="external-link">session_info</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB; font-weight: bold;">─ Session info ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt;  <span style="color: #555555; font-style: italic;">setting </span> <span style="color: #555555; font-style: italic;">value</span></span></span>
<span><span class="co">#&gt;  version  R version 4.4.1 (2024-06-14)</span></span>
<span><span class="co">#&gt;  os       Ubuntu 22.04.5 LTS</span></span>
<span><span class="co">#&gt;  system   x86_64, linux-gnu</span></span>
<span><span class="co">#&gt;  ui       X11</span></span>
<span><span class="co">#&gt;  language en</span></span>
<span><span class="co">#&gt;  collate  C.UTF-8</span></span>
<span><span class="co">#&gt;  ctype    C.UTF-8</span></span>
<span><span class="co">#&gt;  tz       UTC</span></span>
<span><span class="co">#&gt;  date     2024-10-09</span></span>
<span><span class="co">#&gt;  pandoc   3.1.11 @ /opt/hostedtoolcache/pandoc/3.1.11/x64/ (via rmarkdown)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB; font-weight: bold;">─ Packages ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt;  <span style="color: #555555; font-style: italic;">package           </span> <span style="color: #555555; font-style: italic;">*</span> <span style="color: #555555; font-style: italic;">version   </span> <span style="color: #555555; font-style: italic;">date (UTC)</span> <span style="color: #555555; font-style: italic;">lib</span> <span style="color: #555555; font-style: italic;">source</span></span></span>
<span><span class="co">#&gt;  archive              1.1.9      <span style="color: #555555;">2024-09-12</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  bslib                0.8.0      <span style="color: #555555;">2024-07-29</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  cachem               1.1.0      <span style="color: #555555;">2024-05-16</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  cli                  3.6.3      <span style="color: #555555;">2024-06-21</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  codetools            0.2-20     <span style="color: #555555;">2024-03-31</span> <span style="color: #555555;">[3]</span> <span style="color: #555555;">CRAN (R 4.4.1)</span></span></span>
<span><span class="co">#&gt;  crayon               1.5.3      <span style="color: #555555;">2024-06-20</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  dchunkr              <span style="color: #BB00BB; font-weight: bold;">0.0.0.9001</span> <span style="color: #555555;">2024-10-09</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">Github (maurolepore/dchunkr@9748350)</span></span></span>
<span><span class="co">#&gt;  desc                 1.4.3      <span style="color: #555555;">2023-12-10</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  digest               0.6.37     <span style="color: #555555;">2024-08-19</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  dplyr              * 1.1.4      <span style="color: #555555;">2023-11-17</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  evaluate             1.0.0      <span style="color: #555555;">2024-09-17</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  fansi                1.0.6      <span style="color: #555555;">2023-12-08</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  fastmap              1.2.0      <span style="color: #555555;">2024-05-15</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  fs                 * 1.6.4      <span style="color: #555555;">2024-04-25</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  furrr                0.3.1      <span style="color: #555555;">2022-08-15</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  future             * 1.34.0     <span style="color: #555555;">2024-07-29</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  generics             0.1.3      <span style="color: #555555;">2022-07-05</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  globals              0.16.3     <span style="color: #555555;">2024-03-08</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  glue                 1.8.0      <span style="color: #555555;">2024-09-30</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  hms                  1.1.3      <span style="color: #555555;">2023-03-21</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  htmltools            0.5.8.1    <span style="color: #555555;">2024-04-04</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  htmlwidgets          1.6.4      <span style="color: #555555;">2023-12-06</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  httpuv               1.6.15     <span style="color: #555555;">2024-03-26</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  jquerylib            0.1.4      <span style="color: #555555;">2021-04-26</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  jsonlite             1.8.9      <span style="color: #555555;">2024-09-20</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  knitr                1.48       <span style="color: #555555;">2024-07-07</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  later                1.3.2      <span style="color: #555555;">2023-12-06</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  lifecycle            1.0.4      <span style="color: #555555;">2023-11-07</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  listenv              0.9.1      <span style="color: #555555;">2024-01-29</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  magrittr             2.0.3      <span style="color: #555555;">2022-03-30</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  memoise              2.0.1      <span style="color: #555555;">2021-11-26</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  mime                 0.12       <span style="color: #555555;">2021-09-28</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  parallelly           1.38.0     <span style="color: #555555;">2024-07-27</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  pillar               1.9.0      <span style="color: #555555;">2023-03-22</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  pkgconfig            2.0.3      <span style="color: #555555;">2019-09-22</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  pkgdown              2.1.1      <span style="color: #555555;">2024-09-17</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  promises             1.3.0      <span style="color: #555555;">2024-04-05</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  purrr                1.0.2      <span style="color: #555555;">2023-08-10</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  R6                   2.5.1      <span style="color: #555555;">2021-08-19</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  ragg                 1.3.3      <span style="color: #555555;">2024-09-11</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  rappdirs           * 0.3.3      <span style="color: #555555;">2021-01-31</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  Rcpp                 1.0.13     <span style="color: #555555;">2024-07-17</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  readr              * 2.1.5      <span style="color: #555555;">2024-01-10</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  rlang                1.1.4      <span style="color: #555555;">2024-06-04</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  rmarkdown            2.28       <span style="color: #555555;">2024-08-17</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  sass                 0.4.9      <span style="color: #555555;">2024-03-15</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  sessioninfo          1.2.2      <span style="color: #555555;">2021-12-06</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  shiny                1.9.1      <span style="color: #555555;">2024-08-01</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  stringi              1.8.4      <span style="color: #555555;">2024-05-06</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  stringr              1.5.1      <span style="color: #555555;">2023-11-14</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  systemfonts          1.1.0      <span style="color: #555555;">2024-05-15</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  textshaping          0.4.0      <span style="color: #555555;">2024-05-24</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  tibble               3.2.1      <span style="color: #555555;">2023-03-20</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  tidyr                1.3.1      <span style="color: #555555;">2024-01-24</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  tidyselect           1.2.1      <span style="color: #555555;">2024-03-11</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  tiltAddCO2           <span style="color: #BB00BB; font-weight: bold;">0.0.0.9002</span> <span style="color: #555555;">2024-10-09</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">Github (2DegreesInvesting/tiltAddCO2@dc7eacd)</span></span></span>
<span><span class="co">#&gt;  tiltIndicator        <span style="color: #BB00BB; font-weight: bold;">0.0.0.9228</span> <span style="color: #555555;">2024-10-09</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">Github (2DegreesInvesting/tiltIndicator@25abe9a)</span></span></span>
<span><span class="co">#&gt;  tiltIndicatorAfter * <span style="color: #BB00BB; font-weight: bold;">0.0.0.9060</span> <span style="color: #555555;">2024-10-09</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">Github (2DegreesInvesting/tiltIndicatorAfter@e952dae)</span></span></span>
<span><span class="co">#&gt;  tiltPolish           <span style="color: #BB00BB; font-weight: bold;">0.0.0.9006</span> <span style="color: #555555;">2024-10-09</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">Github (2degreesinvesting/tiltPolish@d8bdff6)</span></span></span>
<span><span class="co">#&gt;  tiltToyData        * <span style="color: #BB00BB; font-weight: bold;">0.0.0.9204</span> <span style="color: #555555;">2024-10-09</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">Github (2DegreesInvesting/tiltToyData@3a2417a)</span></span></span>
<span><span class="co">#&gt;  tiltTransitionRisk   <span style="color: #BB00BB; font-weight: bold;">0.0.0.9003</span> <span style="color: #555555;">2024-10-09</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">Github (2degreesinvesting/tiltTransitionRisk@ee013b8)</span></span></span>
<span><span class="co">#&gt;  tiltWorkflows      * <span style="color: #BB00BB; font-weight: bold;">0.0.0.9033</span> <span style="color: #555555;">2024-10-09</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">local</span></span></span>
<span><span class="co">#&gt;  tzdb                 0.4.0      <span style="color: #555555;">2023-05-12</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  utf8                 1.2.4      <span style="color: #555555;">2023-10-22</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  vctrs                0.6.5      <span style="color: #555555;">2023-12-01</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  withr                3.0.1      <span style="color: #555555;">2024-07-31</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  xfun                 0.48       <span style="color: #555555;">2024-10-03</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  xtable               1.8-4      <span style="color: #555555;">2019-04-21</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  yaml                 2.3.10     <span style="color: #555555;">2024-07-26</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [1] /home/runner/work/_temp/Library</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [2] /opt/R/4.4.1/lib/R/site-library</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [3] /opt/R/4.4.1/lib/R/library</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB; font-weight: bold;">──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span></span></span></code></pre></div>
</details>
</div>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>This example defaults to using toy datasets but you may <a href="https://2degreesinvesting.github.io/tiltWorkflows/articles/tiltWorkflows.html">use
the parameters</a> of this file to instead use your own data.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">europages_companies</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">input</span>, <span class="va">params</span><span class="op">$</span><span class="va">europages_companies</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ecoinvent_activities</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">input</span>, <span class="va">params</span><span class="op">$</span><span class="va">ecoinvent_activities</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ecoinvent_europages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">input</span>, <span class="va">params</span><span class="op">$</span><span class="va">ecoinvent_europages</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">isic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">input</span>, <span class="va">params</span><span class="op">$</span><span class="va">isic</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The “upstream” workflows also need this dataset.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ecoinvent_inputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">input</span>, <span class="va">params</span><span class="op">$</span><span class="va">ecoinvent_inputs</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Data specific to this indicator.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">emissions_profile_any_companies</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">input</span>, <span class="va">params</span><span class="op">$</span><span class="va">emissions_profile_any_companies</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># FIXME User toy_emissions_profile_upstream_products_ecoinvent()</span></span>
<span><span class="co"># See https://github.com/2DegreesInvesting/tiltToyData/pull/12</span></span>
<span><span class="co"># https://github.com/2DegreesInvesting/tiltWorkflows/issues/9</span></span>
<span><span class="va">emissions_profile_upstream_products</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">input</span>, <span class="va">params</span><span class="op">$</span><span class="va">emissions_profile_upstream_products</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="emissions-profile-upstream">Emissions profile upstream<a class="anchor" aria-label="anchor" href="#emissions-profile-upstream"></a>
</h2>
<p>For this TILT indicator, compute results both at product and company
level.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">emissions_profile_upstream</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/profile_emissions_upstream.html">profile_emissions_upstream</a></span><span class="op">(</span></span>
<span>  companies <span class="op">=</span> <span class="va">emissions_profile_any_companies</span>,</span>
<span>  co2 <span class="op">=</span> <span class="va">emissions_profile_upstream_products</span>,</span>
<span>  europages_companies <span class="op">=</span> <span class="va">europages_companies</span>,</span>
<span>  ecoinvent_activities <span class="op">=</span> <span class="va">ecoinvent_activities</span>,</span>
<span>  ecoinvent_inputs <span class="op">=</span> <span class="va">ecoinvent_inputs</span>,</span>
<span>  ecoinvent_europages <span class="op">=</span> <span class="va">ecoinvent_europages</span>,</span>
<span>  isic <span class="op">=</span> <span class="va">isic</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Splitting `companies` into 4 chunks.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h2>
<p>Overview and save results at each level.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">emissions_profile_upstream</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tiltIndicator/man/unnest_product.html" class="external-link">unnest_product</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">output</span>, <span class="st">"emissions_profile_upstream_at_product_level.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3,966 × 31</span></span></span>
<span><span class="co">#&gt;    companies_id                       company_name    country emission_upstream_pr…¹ benchmark ep_product matched_activity_name matched_reference_pr…² unit  multi_match matching_certainty matching_certainty_c…³ input_name input_unit input_tilt_sector input_tilt_subsector input_isic_4digit input_isic_4digit_name company_city postcode address main_activity activity_uuid_produc…⁴ profile_ranking ei_input_geography min_headcount max_headcount ei_geography input_activity_uuid_…⁵ co2e_lower co2e_upper</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> asteria_megalotomusquinquespinosus asteria_megalo… austria high                   all       tent       market for shed, lar… shed, large, wood, no… m2    FALSE       low                low                    shed, lar… m2         construction      construction reside… '4100'            Construction of build… wilhelmsburg 3150     flesch… wholesaler    76269c17-78d6-420b-99…           0.938 tilt_land                      1            10 tilt_world   44e5e288-4f81-40d0-88…     0.025<span style="text-decoration: underline;">6</span> 587<span style="text-decoration: underline;">680</span>710.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> asteria_megalotomusquinquespinosus asteria_megalo… austria high                   input_is… tent       market for shed, lar… shed, large, wood, no… m2    FALSE       low                low                    shed, lar… m2         construction      construction reside… '4100'            Construction of build… wilhelmsburg 3150     flesch… wholesaler    76269c17-78d6-420b-99…           1     tilt_land                      1            10 tilt_world   44e5e288-4f81-40d0-88…  -<span style="color: #BB0000;">206.</span>           867.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> asteria_megalotomusquinquespinosus asteria_megalo… austria high                   input_ti… tent       market for shed, lar… shed, large, wood, no… m2    FALSE       low                low                    shed, lar… m2         construction      construction reside… '4100'            Construction of build… wilhelmsburg 3150     flesch… wholesaler    76269c17-78d6-420b-99…           1     tilt_land                      1            10 tilt_world   44e5e288-4f81-40d0-88…  -<span style="color: #BB0000;">268.</span>           412.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> asteria_megalotomusquinquespinosus asteria_megalo… austria high                   input_un… tent       market for shed, lar… shed, large, wood, no… m2    FALSE       low                low                    shed, lar… m2         construction      construction reside… '4100'            Construction of build… wilhelmsburg 3150     flesch… wholesaler    76269c17-78d6-420b-99…           1     tilt_land                      1            10 tilt_world   44e5e288-4f81-40d0-88…  -<span style="color: #BB0000;">185.</span>           535.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> asteria_megalotomusquinquespinosus asteria_megalo… austria high                   input_un… tent       market for shed, lar… shed, large, wood, no… m2    FALSE       low                low                    shed, lar… m2         construction      construction reside… '4100'            Construction of build… wilhelmsburg 3150     flesch… wholesaler    76269c17-78d6-420b-99…           1     tilt_land                      1            10 tilt_world   44e5e288-4f81-40d0-88…   220.           880.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> asteria_megalotomusquinquespinosus asteria_megalo… austria high                   input_un… tent       market for shed, lar… shed, large, wood, no… m2    FALSE       low                low                    shed, lar… m2         construction      construction reside… '4100'            Construction of build… wilhelmsburg 3150     flesch… wholesaler    76269c17-78d6-420b-99…           1     tilt_land                      1            10 tilt_world   44e5e288-4f81-40d0-88…   106.           410.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> skarn_gallinule                    skarn_gallinule austria high                   all       sheds, co… market for shed, lar… shed, large, wood, no… m2    FALSE       low                low                    shed, lar… m2         construction      construction reside… '4100'            Construction of build… wiener neud… 2355     iz nö-… wholesaler    76269c17-78d6-420b-99…           0.938 tilt_land                      1            10 tilt_world   44e5e288-4f81-40d0-88…     0.025<span style="text-decoration: underline;">6</span> 587<span style="text-decoration: underline;">680</span>710.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> skarn_gallinule                    skarn_gallinule austria high                   input_is… sheds, co… market for shed, lar… shed, large, wood, no… m2    FALSE       low                low                    shed, lar… m2         construction      construction reside… '4100'            Construction of build… wiener neud… 2355     iz nö-… wholesaler    76269c17-78d6-420b-99…           1     tilt_land                      1            10 tilt_world   44e5e288-4f81-40d0-88…  -<span style="color: #BB0000;">206.</span>           867.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> skarn_gallinule                    skarn_gallinule austria high                   input_ti… sheds, co… market for shed, lar… shed, large, wood, no… m2    FALSE       low                low                    shed, lar… m2         construction      construction reside… '4100'            Construction of build… wiener neud… 2355     iz nö-… wholesaler    76269c17-78d6-420b-99…           1     tilt_land                      1            10 tilt_world   44e5e288-4f81-40d0-88…  -<span style="color: #BB0000;">268.</span>           412.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> skarn_gallinule                    skarn_gallinule austria high                   input_un… sheds, co… market for shed, lar… shed, large, wood, no… m2    FALSE       low                low                    shed, lar… m2         construction      construction reside… '4100'            Construction of build… wiener neud… 2355     iz nö-… wholesaler    76269c17-78d6-420b-99…           1     tilt_land                      1            10 tilt_world   44e5e288-4f81-40d0-88…  -<span style="color: #BB0000;">185.</span>           535.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3,956 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ abbreviated names: ¹​emission_upstream_profile, ²​matched_reference_product, ³​matching_certainty_company_average, ⁴​activity_uuid_product_uuid, ⁵​input_activity_uuid_product_uuid</span></span></span>
<span></span>
<span><span class="va">emissions_profile_upstream</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/tiltIndicator/man/unnest_product.html" class="external-link">unnest_company</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="fu"><a href="https://fs.r-lib.org/reference/path.html" class="external-link">path</a></span><span class="op">(</span><span class="va">params</span><span class="op">$</span><span class="va">output</span>, <span class="st">"emissions_profile_upstream_at_company_level.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,728 × 13</span></span></span>
<span><span class="co">#&gt;    companies_id                       company_name                       company_city country emission_upstream_profile_share emission_upstream_profile benchmark            matching_certainty_company_average postcode address                                  main_activity profile_ranking_avg co2_avg</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> asteria_megalotomusquinquespinosus asteria_megalotomusquinquespinosus wilhelmsburg austria                               1 high                      all                  low                                3150     fleschplatz 2, top 5 | 3150 wilhelmsburg wholesaler                  0.938    298.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> asteria_megalotomusquinquespinosus asteria_megalotomusquinquespinosus wilhelmsburg austria                               0 medium                    all                  low                                3150     fleschplatz 2, top 5 | 3150 wilhelmsburg wholesaler                  0.938    298.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> asteria_megalotomusquinquespinosus asteria_megalotomusquinquespinosus wilhelmsburg austria                               0 low                       all                  low                                3150     fleschplatz 2, top 5 | 3150 wilhelmsburg wholesaler                  0.938    298.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> asteria_megalotomusquinquespinosus asteria_megalotomusquinquespinosus wilhelmsburg austria                               0 <span style="color: #BB0000;">NA</span>                        all                  low                                3150     fleschplatz 2, top 5 | 3150 wilhelmsburg wholesaler                  0.938    298.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> asteria_megalotomusquinquespinosus asteria_megalotomusquinquespinosus wilhelmsburg austria                               1 high                      input_isic_4digit    low                                3150     fleschplatz 2, top 5 | 3150 wilhelmsburg wholesaler                  1        298.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> asteria_megalotomusquinquespinosus asteria_megalotomusquinquespinosus wilhelmsburg austria                               0 medium                    input_isic_4digit    low                                3150     fleschplatz 2, top 5 | 3150 wilhelmsburg wholesaler                  1        298.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> asteria_megalotomusquinquespinosus asteria_megalotomusquinquespinosus wilhelmsburg austria                               0 low                       input_isic_4digit    low                                3150     fleschplatz 2, top 5 | 3150 wilhelmsburg wholesaler                  1        298.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> asteria_megalotomusquinquespinosus asteria_megalotomusquinquespinosus wilhelmsburg austria                               0 <span style="color: #BB0000;">NA</span>                        input_isic_4digit    low                                3150     fleschplatz 2, top 5 | 3150 wilhelmsburg wholesaler                  1        298.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> asteria_megalotomusquinquespinosus asteria_megalotomusquinquespinosus wilhelmsburg austria                               1 high                      input_tilt_subsector low                                3150     fleschplatz 2, top 5 | 3150 wilhelmsburg wholesaler                  1        298.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> asteria_megalotomusquinquespinosus asteria_megalotomusquinquespinosus wilhelmsburg austria                               0 medium                    input_tilt_subsector low                                3150     fleschplatz 2, top 5 | 3150 wilhelmsburg wholesaler                  1        298.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,718 more rows</span></span></span></code></pre></div>
<p>The results at product and company level are now saved in the output/
directory.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># NOTE: If other workflows run before this one, this shows the results of all</span></span>
<span><span class="va">params</span><span class="op">$</span><span class="va">output</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://fs.r-lib.org/reference/dir_tree.html" class="external-link">dir_tree</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">output</span></span></span>
<span><span class="co">#&gt; ├── emissions_profile_upstream_at_company_level.csv</span></span>
<span><span class="co">#&gt; └── emissions_profile_upstream_at_product_level.csv</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="cleanup">Cleanup<a class="anchor" aria-label="anchor" href="#cleanup"></a>
</h2>
<p>Here is the cache that allows you to resume after interruptions.</p>
<ul>
<li>The number of files is determined by
<code>params$chunks</code>.</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># NOTE: If other workflows run before this one, this shows the cache of all</span></span>
<span><span class="fu"><a href="../reference/cache.html">cache_info</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 16 × 18</span></span></span>
<span><span class="co">#&gt;    modification_time   path                                                               type         size permissions user   group  device_id hard_links special_device_id  inode block_size blocks flags generation access_time         change_time         birth_time         </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;fs::path&gt;</span>                                                         <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fs::bytes&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fs::perms&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2024-10-09 <span style="color: #949494;">09:16:22</span> /home/runner/.cache/tiltWorkflows/profile_emissions/1.rds          file       186.1K rw-r--r--   runner docker      <span style="text-decoration: underline;">2</span>065          1                 0 <span style="text-decoration: underline;">540</span>561       <span style="text-decoration: underline;">4</span>096    376     0          0 2024-10-09 <span style="color: #949494;">09:16:24</span> 2024-10-09 <span style="color: #949494;">09:16:22</span> 2024-10-09 <span style="color: #949494;">09:16:22</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 2024-10-09 <span style="color: #949494;">09:16:23</span> /home/runner/.cache/tiltWorkflows/profile_emissions/2.rds          file       185.5K rw-r--r--   runner docker      <span style="text-decoration: underline;">2</span>065          1                 0 <span style="text-decoration: underline;">540</span>562       <span style="text-decoration: underline;">4</span>096    376     0          0 2024-10-09 <span style="color: #949494;">09:16:24</span> 2024-10-09 <span style="color: #949494;">09:16:23</span> 2024-10-09 <span style="color: #949494;">09:16:23</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 2024-10-09 <span style="color: #949494;">09:16:23</span> /home/runner/.cache/tiltWorkflows/profile_emissions/3.rds          file       190.7K rw-r--r--   runner docker      <span style="text-decoration: underline;">2</span>065          1                 0 <span style="text-decoration: underline;">540</span>563       <span style="text-decoration: underline;">4</span>096    384     0          0 2024-10-09 <span style="color: #949494;">09:16:24</span> 2024-10-09 <span style="color: #949494;">09:16:23</span> 2024-10-09 <span style="color: #949494;">09:16:23</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 2024-10-09 <span style="color: #949494;">09:16:24</span> /home/runner/.cache/tiltWorkflows/profile_emissions/4.rds          file         191K rw-r--r--   runner docker      <span style="text-decoration: underline;">2</span>065          1                 0 <span style="text-decoration: underline;">540</span>564       <span style="text-decoration: underline;">4</span>096    384     0          0 2024-10-09 <span style="color: #949494;">09:16:24</span> 2024-10-09 <span style="color: #949494;">09:16:24</span> 2024-10-09 <span style="color: #949494;">09:16:24</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 2024-10-09 <span style="color: #949494;">09:16:24</span> /home/runner/.cache/tiltWorkflows/profile_emissions_upstream/1.rds file       911.9K rw-r--r--   runner docker      <span style="text-decoration: underline;">2</span>065          1                 0 <span style="text-decoration: underline;">540</span>566       <span style="text-decoration: underline;">4</span>096   <span style="text-decoration: underline;">1</span>824     0          0 2024-10-09 <span style="color: #949494;">09:16:26</span> 2024-10-09 <span style="color: #949494;">09:16:24</span> 2024-10-09 <span style="color: #949494;">09:16:24</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 2024-10-09 <span style="color: #949494;">09:16:25</span> /home/runner/.cache/tiltWorkflows/profile_emissions_upstream/2.rds file       190.9K rw-r--r--   runner docker      <span style="text-decoration: underline;">2</span>065          1                 0 <span style="text-decoration: underline;">540</span>567       <span style="text-decoration: underline;">4</span>096    384     0          0 2024-10-09 <span style="color: #949494;">09:16:26</span> 2024-10-09 <span style="color: #949494;">09:16:25</span> 2024-10-09 <span style="color: #949494;">09:16:25</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 2024-10-09 <span style="color: #949494;">09:16:25</span> /home/runner/.cache/tiltWorkflows/profile_emissions_upstream/3.rds file       922.8K rw-r--r--   runner docker      <span style="text-decoration: underline;">2</span>065          1                 0 <span style="text-decoration: underline;">540</span>569       <span style="text-decoration: underline;">4</span>096   <span style="text-decoration: underline;">1</span>848     0          0 2024-10-09 <span style="color: #949494;">09:16:26</span> 2024-10-09 <span style="color: #949494;">09:16:25</span> 2024-10-09 <span style="color: #949494;">09:16:25</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 2024-10-09 <span style="color: #949494;">09:16:26</span> /home/runner/.cache/tiltWorkflows/profile_emissions_upstream/4.rds file       921.3K rw-r--r--   runner docker      <span style="text-decoration: underline;">2</span>065          1                 0 <span style="text-decoration: underline;">540</span>570       <span style="text-decoration: underline;">4</span>096   <span style="text-decoration: underline;">1</span>848     0          0 2024-10-09 <span style="color: #949494;">09:16:26</span> 2024-10-09 <span style="color: #949494;">09:16:26</span> 2024-10-09 <span style="color: #949494;">09:16:26</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 2024-10-09 <span style="color: #949494;">09:16:29</span> /home/runner/.cache/tiltWorkflows/profile_sector/1.rds             file        91.6K rw-r--r--   runner docker      <span style="text-decoration: underline;">2</span>065          1                 0 <span style="text-decoration: underline;">551</span>611       <span style="text-decoration: underline;">4</span>096    184     0          0 2024-10-09 <span style="color: #949494;">09:16:29</span> 2024-10-09 <span style="color: #949494;">09:16:29</span> 2024-10-09 <span style="color: #949494;">09:16:29</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 2024-10-09 <span style="color: #949494;">09:16:29</span> /home/runner/.cache/tiltWorkflows/profile_sector/2.rds             file        88.4K rw-r--r--   runner docker      <span style="text-decoration: underline;">2</span>065          1                 0 <span style="text-decoration: underline;">551</span>639       <span style="text-decoration: underline;">4</span>096    184     0          0 2024-10-09 <span style="color: #949494;">09:16:29</span> 2024-10-09 <span style="color: #949494;">09:16:29</span> 2024-10-09 <span style="color: #949494;">09:16:29</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> 2024-10-09 <span style="color: #949494;">09:16:29</span> /home/runner/.cache/tiltWorkflows/profile_sector/3.rds             file        89.8K rw-r--r--   runner docker      <span style="text-decoration: underline;">2</span>065          1                 0 <span style="text-decoration: underline;">551</span>643       <span style="text-decoration: underline;">4</span>096    184     0          0 2024-10-09 <span style="color: #949494;">09:16:29</span> 2024-10-09 <span style="color: #949494;">09:16:29</span> 2024-10-09 <span style="color: #949494;">09:16:29</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> 2024-10-09 <span style="color: #949494;">09:16:29</span> /home/runner/.cache/tiltWorkflows/profile_sector/4.rds             file        87.9K rw-r--r--   runner docker      <span style="text-decoration: underline;">2</span>065          1                 0 <span style="text-decoration: underline;">551</span>644       <span style="text-decoration: underline;">4</span>096    176     0          0 2024-10-09 <span style="color: #949494;">09:16:29</span> 2024-10-09 <span style="color: #949494;">09:16:29</span> 2024-10-09 <span style="color: #949494;">09:16:29</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> 2024-10-09 <span style="color: #949494;">09:16:30</span> /home/runner/.cache/tiltWorkflows/profile_sector_upstream/1.rds    file       100.5K rw-r--r--   runner docker      <span style="text-decoration: underline;">2</span>065          1                 0 <span style="text-decoration: underline;">551</span>646       <span style="text-decoration: underline;">4</span>096    208     0          0 2024-10-09 <span style="color: #949494;">09:16:30</span> 2024-10-09 <span style="color: #949494;">09:16:30</span> 2024-10-09 <span style="color: #949494;">09:16:30</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> 2024-10-09 <span style="color: #949494;">09:16:30</span> /home/runner/.cache/tiltWorkflows/profile_sector_upstream/2.rds    file       119.8K rw-r--r--   runner docker      <span style="text-decoration: underline;">2</span>065          1                 0 <span style="text-decoration: underline;">551</span>647       <span style="text-decoration: underline;">4</span>096    240     0          0 2024-10-09 <span style="color: #949494;">09:16:30</span> 2024-10-09 <span style="color: #949494;">09:16:30</span> 2024-10-09 <span style="color: #949494;">09:16:30</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> 2024-10-09 <span style="color: #949494;">09:16:30</span> /home/runner/.cache/tiltWorkflows/profile_sector_upstream/3.rds    file       101.2K rw-r--r--   runner docker      <span style="text-decoration: underline;">2</span>065          1                 0 <span style="text-decoration: underline;">551</span>648       <span style="text-decoration: underline;">4</span>096    208     0          0 2024-10-09 <span style="color: #949494;">09:16:30</span> 2024-10-09 <span style="color: #949494;">09:16:30</span> 2024-10-09 <span style="color: #949494;">09:16:30</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> 2024-10-09 <span style="color: #949494;">09:16:30</span> /home/runner/.cache/tiltWorkflows/profile_sector_upstream/4.rds    file       135.9K rw-r--r--   runner docker      <span style="text-decoration: underline;">2</span>065          1                 0 <span style="text-decoration: underline;">551</span>649       <span style="text-decoration: underline;">4</span>096    272     0          0 2024-10-09 <span style="color: #949494;">09:16:30</span> 2024-10-09 <span style="color: #949494;">09:16:30</span> 2024-10-09 <span style="color: #949494;">09:16:30</span></span></span></code></pre></div>
<p>If you want to recompute some result, you must first delete the
relevant cache:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://fs.r-lib.org" class="external-link">fs</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rappdirs.r-lib.org" class="external-link">rappdirs</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://fs.r-lib.org/reference/delete.html" class="external-link">dir_delete</a></span><span class="op">(</span><span class="fu"><a href="https://rappdirs.r-lib.org/reference/user_cache_dir.html" class="external-link">user_cache_dir</a></span><span class="op">(</span><span class="st">"tiltWorkflows/PROFILE-DIRECTORY-YOU-WANT-TO-DELETE"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># DANGER: Or delete the entire default cache directory with</span></span>
<span><span class="fu"><a href="../reference/cache.html">cache_delete</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/maurolepore" class="external-link">Mauro Lepore</a>, Anne Schoenauer, Tilman Trompke, Kalash Singhal, 2 Degrees Investing Initiative.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
